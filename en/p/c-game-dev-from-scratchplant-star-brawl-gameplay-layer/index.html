<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Creating a simplified two-player platform shooter inspired by Super Smash Bros. mechanics. This post covers the second half of my notes from the second project of this tutorial series.">
<title>【C&#43;&#43; Game Dev from Scratch】Plant Star Brawl - Gameplay Layer</title>

<link rel='canonical' href='https://nullshowjl.github.io/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/'>

<link rel="stylesheet" href="/scss/style.min.3b99540141ea6d96ea57a2341f6a138640e2de77d5547ecfa3a88330ad283de6.css"><meta property='og:title' content="【C++ Game Dev from Scratch】Plant Star Brawl - Gameplay Layer">
<meta property='og:description' content="Creating a simplified two-player platform shooter inspired by Super Smash Bros. mechanics. This post covers the second half of my notes from the second project of this tutorial series.">
<meta property='og:url' content='https://nullshowjl.github.io/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/'>
<meta property='og:site_name' content='Nullshow&#39;s Tech Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Game Dev' /><meta property='article:tag' content='C&#43;&#43;' /><meta property='article:tag' content='EasyX' /><meta property='article:published_time' content='2025-10-12T09:17:30&#43;02:00'/><meta property='article:modified_time' content='2025-10-16T22:22:33&#43;02:00'/><meta property='og:image' content='https://nullshowjl.github.io/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/cover.webp' />
<meta name="twitter:title" content="【C++ Game Dev from Scratch】Plant Star Brawl - Gameplay Layer">
<meta name="twitter:description" content="Creating a simplified two-player platform shooter inspired by Super Smash Bros. mechanics. This post covers the second half of my notes from the second project of this tutorial series."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://nullshowjl.github.io/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/cover.webp' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
        
        <figure class="site-avatar">
            <a href="/en/">
                
                

                
                
                <img src="/img/avatar_hu_707be34854ee244.png" width="300"
                     height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                
            </a>
            
            <span class="emoji">✍️</span>
            
        </figure>
        
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/en">Nullshow&#39;s Tech Blog</a></h1>
            <h2 class="site-description">Sharing and documenting my notes, experiences, and reflections from development and learning~</h2>
        </div>
    </header><ol class="menu-social">
        
        
        
        <li>
            <a href='https://gitee.com/nullshow'
                target="_blank" 
                title="Gitee" 
               rel="me">
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-hexagon-letter-g" class="icon-tabler-hexagon-letter-g"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.875 6.27a2.225 2.225 0 0 1 1.125 1.948v7.284c0 .809 -.443 1.555 -1.158 1.948l-6.75 4.27a2.269 2.269 0 0 1 -2.184 0l-6.75 -4.27a2.225 2.225 0 0 1 -1.158 -1.948v-7.285c0 -.809 .443 -1.554 1.158 -1.947l6.75 -3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98h-.033z" /><path d="M14 8h-2a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2v-4h-1" /></svg>
                
            </a>
        </li>
        
        
        
        <li>
            <a href='https://github.com/NullshowJL'
                target="_blank" 
                title="GitHub" 
               rel="me">
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-brand-github">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                
            </a>
        </li>
        
        
        
        
        
        <li>
            <a href='/en/index.xml'
                target="_blank" 
                title="RSS" 
               rel="me">
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-rss" class="icon-tabler-brand-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>
                
            </a>
        </li>
        
    </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/en/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-home">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/about/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-user">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/portfolio/' >
                
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-gamepad-2" class="icon-tabler-device-gamepad"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5h3.5a5 5 0 0 1 0 10h-5.5l-4.015 4.227a2.3 2.3 0 0 1 -3.923 -2.035l1.634 -8.173a5 5 0 0 1 4.904 -4.019h3.4z" /><path d="M14 15l4.07 4.284a2.3 2.3 0 0 0 3.925 -2.023l-1.6 -8.232" /><path d="M8 9v2" /><path d="M7 10h2" /><path d="M14 10h2" /></svg>
                
                <span>Portfolio</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/update-log/' >
                
                
                
                <!--
unicode: "fea7"
version: "3.1"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#000000"
  stroke-width="0.5"
  stroke-linecap="round"
  stroke-linejoin="round"
 class="icon-tabler-logs">
  <path d="M4 12h.01" />
  <path d="M4 6h.01" />
  <path d="M4 18h.01" />
  <path d="M8 18h2" />
  <path d="M8 12h2" />
  <path d="M8 6h2" />
  <path d="M14 6h6" />
  <path d="M14 12h6" />
  <path d="M14 18h6" />
</svg>

                
                <span>Update Log</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/archives/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-archives">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/search/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-search">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/links/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-link">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-language">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                        <option value="https://nullshowjl.github.io/en/"  selected>English</option>
                        
                        <option value="https://nullshowjl.github.io/" >中文</option>
                        
                    </select>
                </li>
                
                

                
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-toggle-left">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-toggle-right">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-hash">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#development-workflow---gameplay-layer">Development Workflow - Gameplay Layer</a></li>
    <li><a href="#key-steps-and-solutions---gameplay-layer">Key Steps and Solutions - Gameplay Layer</a>
      <ol>
        <li><a href="#building-the-main-menu-scene-and-character-selection-scene">Building the Main Menu Scene and Character Selection Scene</a>
          <ol>
            <li><a href="#handling-the-camera">Handling the Camera</a></li>
            <li><a href="#implementing-the-main-menu-scene">Implementing the Main Menu Scene</a></li>
            <li><a href="#implementing-the-selector-scene">Implementing the Selector Scene</a></li>
          </ol>
        </li>
        <li><a href="#physics-engine-implementation">Physics Engine Implementation</a>
          <ol>
            <li><a href="#platform-class-design">Platform Class Design</a></li>
            <li><a href="#player-base-class-design">Player Base Class Design</a></li>
            <li><a href="#one-way-platform-collision-and-gravity-simulation">One-Way Platform Collision and Gravity Simulation</a></li>
          </ol>
        </li>
        <li><a href="#character-skill-system">Character Skill System</a>
          <ol>
            <li><a href="#functional-requirements">Functional Requirements</a></li>
            <li><a href="#bullet-deactivation-and-removal-logic">Bullet Deactivation and Removal Logic</a></li>
            <li><a href="#full-bullet-base-class">Full Bullet Base Class</a></li>
            <li><a href="#pea-bullet-class-design">Pea Bullet Class Design</a></li>
            <li><a href="#sun-bullet-class-implementation">Sun Bullet Class Implementation</a></li>
            <li><a href="#sun-bullet-ex-class-implementation">Sun Bullet Ex Class Implementation</a></li>
            <li><a href="#skill-system">Skill System</a></li>
            <li><a href="#invulnerability-state-implementation">Invulnerability State Implementation</a></li>
          </ol>
        </li>
        <li><a href="#particle-system-implementation">Particle System Implementation</a></li>
      </ol>
    </li>
    <li><a href="#overall-code-review-and-source-code">Overall Code Review and Source Code</a>
      <ol>
        <li><a href="#scene-base-class">Scene Base Class</a></li>
        <li><a href="#main-function">Main Function</a></li>
        <li><a href="#atlas-class">Atlas Class</a></li>
        <li><a href="#camera-class">Camera Class</a></li>
        <li><a href="#timer-and-vector2-classes">Timer and Vector2 Classes</a></li>
        <li><a href="#scene-subclasses-menuscene-selectorscene-gamescene">Scene Subclasses: MenuScene, SelectorScene, GameScene</a></li>
        <li><a href="#player-base-class">Player Base Class</a></li>
        <li><a href="#peashooter-and-sunflower-subclasses">Peashooter and Sunflower Subclasses</a></li>
        <li><a href="#bullet-base-class">Bullet Base Class</a></li>
        <li><a href="#peabullet-sunbullet-and-sunbulletex-subclasses">PeaBullet, SunBullet, and SunBulletEx Subclasses</a></li>
        <li><a href="#particle-class">Particle Class</a></li>
        <li><a href="#platform-class">Platform Class</a></li>
        <li><a href="#statusbar-class">StatusBar Class</a></li>
        <li><a href="#full-source-code">Full Source Code</a></li>
      </ol>
    </li>
    <li><a href="#reflection-and-summary">Reflection and Summary</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/">
                <img src="/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/cover_hu_5c6515f1215a1dc9.webp"
                        srcset="/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/cover_hu_5c6515f1215a1dc9.webp 800w, /en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/cover_hu_2d86bc8aa73f0807.webp 1600w"
                        width="800" 
                        height="240" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43; Game Dev from Scratch】Plant Star Brawl - Gameplay Layer" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/en/categories/study-notes/" style="background-color: #2a9d8f; color: #fff;">
                Study Notes
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/en/p/c-game-dev-from-scratchplant-star-brawl-gameplay-layer/">【C&#43;&#43; Game Dev from Scratch】Plant Star Brawl - Gameplay Layer</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Creating a simplified two-player platform shooter inspired by Super Smash Bros. mechanics. This post covers the second half of my notes from the second project of this tutorial series.
        </h3>
        
    </div>

    
    
    
    
<footer class="article-time">
    
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-date">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
        <time class="article-time--published">Oct 12, 2025</time>
    </div>
    

    
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-clock">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--reading">
            31 minute read
        </time>
    </div>
    

    
    <div id="viewCount">
        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-eye" class="icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
        <time class="article-time--reading">
            
            <span id="vercount_value_page_pv">loading... </span> views
        </time>
    </div>

</footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><strong>Table of Contents</strong></p>
<ul>
<li><a class="link" href="#development-workflow---gameplay-layer" >Development Workflow – Gameplay Layer</a></li>
<li><a class="link" href="#key-steps-and-solutions---gameplay-layer" >Key Steps and Solutions – Gameplay Layer</a></li>
<li><a class="link" href="#overall-code-review-and-source-code" >Overall Code Review and Source Code</a></li>
<li><a class="link" href="#reflection-and-summary" >Reflection and Summary</a></li>
</ul>
<p>This article dives into the implementation of the gameplay layer in detail and concludes with a link to the full project source code. If you’d like to revisit the overall project structure and framework design, check out the companion post: <a class="link" href="https://nullshowjl.github.io/en/p/c-game-dev-from-scratchplant-star-brawl-framework-design/"  target="_blank" rel="noopener"
    ><em><strong>Plant Star Brawl - Framework Design</strong></em></a>.</p>
<h2 id="development-workflow---gameplay-layer">Development Workflow - Gameplay Layer
</h2><ul>
<li>
<p><strong>Main Menu and Character Selection Screens</strong></p>
<ul>
<li>Challenge 1: Where should the main camera be placed, given that the project uses a camera class?
<ul>
<li>Solution: Pass the camera as a parameter to rendering functions.</li>
</ul>
</li>
<li>Challenge  2: How can we give text a 3D or embossed effect?
<ul>
<li>Solution: Render the text twice—once in white at the original position, and once in gray slightly offset downward and to the right.</li>
</ul>
</li>
<li>Challenge  3: How can we create a scrolling silhouette effect on the selection screen background
<ul>
<li>Solution: Draw the same image twice with offset positions to simulate motion.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>In-Game Scene Setup and Physics Simulation</strong></p>
<ul>
<li>Challenge 1: How do we simulate gravity?
<ul>
<li>Solution: Gravity is represented by falling and stopping. Encapsulate platform logic in a dedicated class.</li>
</ul>
</li>
<li>Challenge 2: How can we visually inspect collision data?
<ul>
<li>Solution: Implement a simple debug mode to visualize hitboxes and physics boundaries.</li>
</ul>
</li>
<li>Issue 1: Why does the player sometimes teleport upward during a fall?
<ul>
<li>Solution: Use the player’s foot position from the previous frame to determine whether to correct their position in the current frame.</li>
</ul>
</li>
<li>Issue 2: How do we prevent repeated jumping (multi-jump bugs)?
<ul>
<li>Solution: Ensure the player can only jump when their vertical velocity is zero.</li>
</ul>
</li>
</ul>
<p><strong>Bullet Base Class Implementation</strong></p>
<ul>
<li>Core Gameplay Mechanic: Players deal damage using projectile-like bullets.
<ul>
<li>Solution: Create a base <code>Bullet</code> class, with specific bullet types inheriting from it.</li>
</ul>
</li>
<li>Challenge: How should bullets disappear after collision?
<ul>
<li>Solution: Use callback functions, similar to how death animations are handled for players.</li>
</ul>
</li>
<li>Bullet Deletion Optimization</li>
</ul>
</li>
<li>
<p><strong>Pea Bullet Subclass Implementation</strong></p>
</li>
<li>
<p><strong>Sun Bullet Subclass, Sun Bullet Ex Subclass Implementation</strong></p>
<ul>
<li>Note: Adjust sprite offsets during explosion animations for accurate visual alignment.</li>
</ul>
</li>
<li>
<p><strong>Attack Skill System</strong></p>
<ul>
<li>Use timers to track cooldown durations for special abilities</li>
</ul>
</li>
<li>
<p><strong>Invincibility Frames</strong></p>
<ul>
<li>Solution: During certain animations, alternate between normal sprites and pure white silhouettes to indicate invulnerability.</li>
</ul>
</li>
<li>
<p><strong>Player Status Bar (Health and energy levels)</strong></p>
</li>
<li>
<p><strong>Particle System</strong></p>
</li>
<li>
<p><strong>Win/Loss Detection and Endgame Effects</strong></p>
</li>
</ul>
<h2 id="key-steps-and-solutions---gameplay-layer">Key Steps and Solutions - Gameplay Layer
</h2><h3 id="building-the-main-menu-scene-and-character-selection-scene">Building the Main Menu Scene and Character Selection Scene
</h3><h4 id="handling-the-camera">Handling the Camera
</h4><p><strong>Where should the main camera be placed?</strong></p>
<p>Since this project includes a dedicated <code>Camera</code> class, each scene must be able to access the camera object during rendering to draw the game world relative to its position. There are three possible approaches:</p>
<h5 id="option-1">Option 1:
</h5><p>Define the camera as a member variable inside each scene class. However, this makes it difficult to share camera data across scenes.</p>
<h5 id="option-2">Option 2:
</h5><p>Define the camera as a global variable, similar to how image resources are handled. We could use the <code>extern</code> keyword to access it. But global variables tend to clutter the design and conflict with our goal of encapsulating data and minimizing global state.</p>
<h5 id="option-3">Option 3:
</h5><p>Take inspiration from how <code>delta</code> (elapsed time) is passed into update functions like <code>void on_update(int delta)</code>. We apply the same idea to rendering: pass the camera as a parameter using <code>void on_draw(const Camera&amp; camera)</code>.</p>
<h4 id="implementing-the-main-menu-scene">Implementing the Main Menu Scene
</h4><p>Once the camera handling strategy is decided, here’s the full implementation of the main menu scene:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">IMAGE</span> <span class="n">img_menu_background</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">SceneManager</span> <span class="n">scene_manager</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MenuScene</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Scene</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">MenuScene</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">MenuScene</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Override necessary virtual functions from the base Scene class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">on_enter</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play bgm_menu repeat from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">putimage</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_menu_background</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_input</span><span class="p">(</span><span class="k">const</span> <span class="n">ExMessage</span><span class="o">&amp;</span> <span class="n">msg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">WM_KEYUP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play ui_confirm from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">scene_manager</span><span class="p">.</span><span class="n">switch_to</span><span class="p">(</span><span class="n">SceneManager</span><span class="o">::</span><span class="n">SceneType</span><span class="o">::</span><span class="n">Selector</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_exit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="implementing-the-selector-scene">Implementing the Selector Scene
</h4><h5 id="character-type-design-tip">Character Type Design Tip
</h5><p>We start by defining an enumeration for the available player character types. Why include an “Invalid” character type? It acts as a safeguard to ensure that selection logic doesn’t go out of bounds. This helps prevent bugs when navigating the character list and makes the system more robust.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">enum</span> <span class="k">class</span> <span class="nc">PlayerType</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Peashooter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Sunflower</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Invalid</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Example: Switching Player 1’s Character to the Left</strong></p>
<p>To implement leftward character selection for Player 1, we follow a safe and bounded approach using the <code>PlayerType</code> enumeration:</p>
<ol>
<li><strong>Convert the current enum value to an</strong> <code>int</code> <strong>and subtract 1</strong>   This moves the selection one step to the left.</li>
<li><strong>Add the</strong> <code>int</code> <strong>value of</strong> <code>PlayerType::Invalid</code>   This ensures the result is non-negative, even if the original value was 0.</li>
<li><strong>Take the result modulo</strong> <code>PlayerType::Invalid</code>   This wraps the value around if it goes below the first valid type, keeping it within bounds.</li>
<li><strong>Cast the final result back to</strong> <code>PlayerType</code>   This gives us a valid enum value within the range <code>[Peashooter, Invalid)</code>—a half-open interval that excludes the <code>Invalid</code> sentinel.</li>
</ol>
<p>This technique guarantees that the selected character type always stays within the valid range, and avoids out-of-bounds errors when navigating the character list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">case</span> <span class="nl">WM_KEYUP</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">vkcode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="mh">0x41</span><span class="o">:</span> <span class="c1">// &#39;A&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">is_btn_1P_left_down</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">player_type_1</span> <span class="o">=</span> <span class="p">(</span><span class="n">PlayerType</span><span class="p">)(((</span><span class="kt">int</span><span class="p">)</span><span class="n">PlayerType</span><span class="o">::</span><span class="n">Invalid</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">player_type_1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">PlayerType</span><span class="o">::</span><span class="n">Invalid</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play ui_switch from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="integrating-the-camera-into-the-animation-class">Integrating the Camera into the <code>Animation</code> Class
</h5><p>Since every animation needs to access the camera’s position during rendering, and this logic is repeated across all animation draws, we apply <strong>object-oriented encapsulation</strong> to streamline it.</p>
<p>Instead of calculating <code>world position - camera position</code> externally, we move this logic into the <code>Animation</code> class itself. As a result, the <code>on_draw</code> method is updated to: <code>void on_draw(const Camera&amp; camera, int x, int y) const</code> . This allows each animation to handle its own coordinate transformation internally, keeping rendering logic clean and consistent.</p>
<h5 id="implementing-the-scrolling-silhouette-background-effect">Implementing the Scrolling Silhouette Background Effect
</h5><p>A simple way to create a scrolling background is to render the same image twice. Imagine a vertical reference line moving from the left edge of the screen to the right. When it reaches the far edge, it jumps back to the start.</p>
<p>We draw one copy of the image to the left of the line, and another to the right. This creates a seamless scrolling loop.</p>
<img src="plant1.gif" alt="" style="zoom:100%;" />
<p><strong>Update Logic</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">animation_peashooter</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">animation_sunflower</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Scroll background horizontally
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">selector_background_scroll_offset_x</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">selector_background_scroll_offset_x</span> <span class="o">&gt;=</span> <span class="n">img_peashooter_selector_background_left</span><span class="p">.</span><span class="n">getwidth</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">selector_background_scroll_offset_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To render cropped sections of an image with alpha blending, we overload <code>putimage_alpha</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">putimage_alpha</span><span class="p">(</span><span class="kt">int</span> <span class="n">dst_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dst_y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="n">IMAGE</span><span class="o">*</span> <span class="n">img</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">width</span> <span class="p">:</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nl">height</span> <span class="p">:</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">AlphaBlend</span><span class="p">(</span><span class="n">GetImageHDC</span><span class="p">(</span><span class="n">GetWorkingImage</span><span class="p">()),</span> <span class="n">dst_x</span><span class="p">,</span> <span class="n">dst_y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">GetImageHDC</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">src_x</span><span class="p">,</span> <span class="n">src_y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="p">{</span> <span class="n">AC_SRC_OVER</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">AC_SRC_ALPHA</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We scroll Player 2’s silhouette across Player 1’s background, and vice versa:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">IMAGE</span><span class="o">*</span> <span class="n">img_P1_selector_background</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">IMAGE</span><span class="o">*</span> <span class="n">img_P2_selector_background</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">// Assign scrolling backgrounds based on opponent&#39;s character
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">switch</span> <span class="p">(</span><span class="n">player_type_2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Peashooter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P1_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_peashooter_selector_background_right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Sunflower</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P1_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_sunflower_selector_background_right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P1_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_peashooter_selector_background_right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">switch</span> <span class="p">(</span><span class="n">player_type_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Peashooter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P2_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_peashooter_selector_background_left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Sunflower</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P2_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_sunflower_selector_background_left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">img_P2_selector_background</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">img_peashooter_selector_background_left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">putimage</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_selector_background</span><span class="p">);</span>  <span class="c1">// Draw static background	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Draw dynamic scrolling silhouettes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">selector_background_scroll_offset_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img_P2_selector_background</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">img_P2_selector_background</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img_P2_selector_background</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">selector_background_scroll_offset_x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mi">0</span><span class="p">,</span> <span class="n">img_P2_selector_background</span><span class="p">,</span> <span class="n">selector_background_scroll_offset_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">selector_background_scroll_offset_x</span> <span class="o">-</span> <span class="n">img_P1_selector_background</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img_P1_selector_background</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">selector_background_scroll_offset_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">img_P1_selector_background</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">selector_background_scroll_offset_x</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mi">0</span><span class="p">,</span> <span class="n">img_P1_selector_background</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">pos_img_VS</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos_img_VS</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_VS</span><span class="p">);</span> <span class="c1">// Draw &#34;VS&#34; graphic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="physics-engine-implementation">Physics Engine Implementation
</h3><h4 id="platform-class-design">Platform Class Design
</h4><p>We start by designing the platform collider based on its functional role. In most 2D platformer games, platforms are typically <strong>one-way colliders</strong>—players can land on them from above, but jump through them from below. This means we only need to determine where the player can “stand,” so we abstract the platform collider as a <strong>single horizontal line</strong>.</p>
<p>It’s important to note that while the platform’s position is stored in the collider structure, we still need to separately track its rendering position. This is because the platform image has thickness, and its top edge may not align with the collision line. Typically, the <strong>collision line is slightly above the visible top of the platform image</strong>, which better matches player expectations visually.</p>
<p>This design also aligns with our broader architectural principle of <strong>separating data logic from rendering</strong>. During collision detection, we only care about the <code>CollisionShape</code> data. During rendering, we only care about the image and its draw position. This reinforces <strong>decoupling</strong> and keeps the code clean.</p>
<p>To support debugging, we add a simple debug mode that draws the collision line when enabled. Here’s the full implementation of the <code>Platform</code> class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">bool</span> <span class="n">is_debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Platform</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="nc">CollisionShape</span> <span class="c1">// Describes the collider shape
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">y</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">x_left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">x_right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">CollisionShape</span> <span class="n">shape</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Decoupled logic and rendering
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">IMAGE</span><span class="o">*</span> <span class="n">img</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">POINT</span> <span class="n">render_position</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Platform</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Platform</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="n">render_position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">render_position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">img</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Draw collision line if debug mode is enabled
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">is_debug</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">setlinecolor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">line</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">shape</span><span class="p">.</span><span class="n">x_left</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">shape</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">shape</span><span class="p">.</span><span class="n">x_right</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">shape</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="player-base-class-design">Player Base Class Design
</h4><p>All shared data and logic for players are encapsulated in a base <code>Player</code> class. Specific characters like Peashooter and Sunflower inherit from this base and implement their own behavior.</p>
<p><strong>How are player objects instantiated?</strong></p>
<p>Since there are two player types, the actual class to instantiate depends on the character selected during the character selection phase. This logic belongs in the selector scene, but the instantiated player objects are also needed in the gameplay scene. The simplest solution is to define them globally, just like other cross-scene resources.</p>
<p>Here’s how the instantiation logic looks in the selector scene:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// SelectorScene.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">SelectorScene</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Scene</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="n">on_exit</span><span class="p">()</span> 
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Instantiate player objects based on selected character types
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">switch</span> <span class="p">(</span><span class="n">player_type_1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Peashooter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">player_1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PeashooterPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Sunflower</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">player_1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SunflowerPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="p">(</span><span class="n">player_type_2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Peashooter</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">player_2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PeashooterPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">PlayerType</span><span class="o">::</span><span class="nl">Sunflower</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">player_2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SunflowerPlayer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In addition, each player needs to store their position in world coordinates using <code>Vector2 position;</code>. Animation definitions should also be included, with each subclass specifying which atlas to use for rendering.</p>
<p>Handling player input and mapping key events to gameplay logic should be implemented in the base class. To differentiate controls between Player 1 and Player 2, we assign a <strong>player index</strong> as a member variable. This allows input handling logic to branch based on the player’s identity.</p>
<h4 id="one-way-platform-collision-and-gravity-simulation">One-Way Platform Collision and Gravity Simulation
</h4><h5 id="gravity-simulation">Gravity Simulation
</h5><p>In a free-fall scenario, two key values govern motion: gravitational acceleration and the object’s current velocity. Throughout the simulation, objects in the scene are constantly pulled downward by gravity, accelerating vertically over time.</p>
<p>To model this, we define a gravity constant in the <code>Player</code> class: <code>const float gravity = 1.6e-3f;	</code>. This value may seem arbitrary, but in game development, gravity is often tuned to suit the game world’s scale, visual proportions, and player feel. It doesn’t need to match real-world physics—it just needs to produce the right gameplay effect.</p>
<p>All physics-related logic is placed in the <code>move_and_collide(int delta)</code> method. Gravity simulation itself only requires two lines:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">move_and_collide</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// ......
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="one-way-platform-collision-detection">One-Way Platform Collision Detection
</h5><p>To detect collisions between the player and platforms, we check for horizontal overlap between a rectangle (the player) and a line (the platform). Specifically:</p>
<ul>
<li>Calculate the difference between the rightmost and leftmost edges of both shapes.</li>
<li>If this difference is less than the sum of their widths, they overlap horizontally.</li>
</ul>
<img src="plant2.webp" alt="" style="zoom:33%;" />
<p>Vertical collision is simpler: check whether the platform’s Y-coordinate lies between the player’s top and bottom edges. Only when both horizontal and vertical conditions are met do we consider a collision.</p>
<p><strong>Position Correction Logic</strong></p>
<p>Once a collision is detected, we need to adjust the player’s position so they land on the platform. However, naïvely snapping the player’s feet to the platform can cause visual glitches—especially when the player jumps upward and only partially intersects the platform before falling.</p>
<img src="plant3.gif" alt="" style="zoom:80%;" />
<p>To fix this, we ensure that the player’s entire body has passed through the platform before snapping them onto it. We calculate the player’s foot position from the previous frame and only apply correction if it was above the platform.</p>
<p>Here’s the refined collision logic:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">move_and_collide</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Collision detection
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="n">Platform</span><span class="o">&amp;</span> <span class="nl">platform</span> <span class="p">:</span> <span class="n">platform_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">Platform</span><span class="o">::</span><span class="n">CollisionShape</span><span class="o">&amp;</span> <span class="n">shape</span> <span class="o">=</span> <span class="n">platform</span><span class="p">.</span><span class="n">shape</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">bool</span> <span class="n">is_collide_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="p">.</span><span class="n">x_right</span><span class="p">)</span> <span class="o">-</span> <span class="n">min</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="p">.</span><span class="n">x_left</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">x_right</span> <span class="o">-</span> <span class="n">shape</span><span class="p">.</span><span class="n">x_left</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="kt">bool</span> <span class="n">is_collide_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">shape</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">is_collide_x</span> <span class="o">&amp;&amp;</span> <span class="n">is_collide_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//  Check previous frame’s foot position to avoid snapping mid-jump
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kt">float</span> <span class="n">delta_pos_y</span> <span class="o">=</span> <span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="kt">float</span> <span class="n">last_tick_foot_pos_y</span> <span class="o">=</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">delta_pos_y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">last_tick_foot_pos_y</span> <span class="o">&lt;=</span> <span class="n">shape</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">shape</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="character-skill-system">Character Skill System
</h3><h4 id="functional-requirements">Functional Requirements
</h4><p>This project features two playable characters: Peashooter and Sunflower. Each has a basic attack and a special skill.</p>
<ul>
<li><strong>Peashooter</strong>: Fires pea bullets in the direction they’re facing. Hitting the opponent builds energy. Once full, Peashooter unleashes a rapid burst of pea bullets as a special attack.</li>
<li><strong>Sunflower</strong>: Throws sun bombs diagonally upward. These projectiles are affected by gravity, making them harder to aim but more rewarding. When energy is full, Sunflower summons a giant sun bomb above the opponent’s head, dealing massive area damage and granting high energy returns.</li>
</ul>
<p>From a design perspective, both characters rely on projectile-based combat. This allows us to unify all projectile logic under a single base class: <code>Bullet</code>.</p>
<p>Each projectile type—pea bullet, sun bomb, super sun bomb—can inherit from <code>Bullet</code> and implement its own update and rendering logic. Differences like animation, damage radius, and behavior are handled in the subclasses.</p>
<h4 id="bullet-deactivation-and-removal-logic">Bullet Deactivation and Removal Logic
</h4><p>Just like how we handle player death animations in the <code>Animation</code> class, bullets should be marked as invalid immediately upon hitting an enemy. This prevents them from colliding multiple times in subsequent frames. However, since we want to play destruction animations—like the pea bullet shattering or the sun bomb exploding—we can’t remove the bullet object from the scene right away.</p>
<p>Instead, each bullet goes through three distinct states:</p>
<ol>
<li><strong>Active</strong>: The bullet is moving and checking for collisions.</li>
<li><strong>Inactive</strong>: The bullet has collided and is playing its destruction animation. Collision checks are disabled.</li>
<li><strong>Removable</strong>: The animation has finished, and the bullet can now be deleted from the scene.</li>
</ol>
<p>This state logic is reflected in the bullet’s member variables:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Bullet.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">size</span><span class="p">;</span>						<span class="c1">// Bullet collider size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vector2</span> <span class="n">position</span><span class="p">;</span>					<span class="c1">// Bullet position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vector2</span> <span class="n">velocity</span><span class="p">;</span>					<span class="c1">// Bullet velocity
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">damage</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>					<span class="c1">// Damage value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>					<span class="c1">// Whether the bullet is still active
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">can_remove</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>			<span class="c1">//  Whether the bullet can be deleted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">;</span>			<span class="c1">// Collision callback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">PlayerID</span> <span class="n">target_id</span> <span class="o">=</span> <span class="n">PlayerID</span><span class="o">::</span><span class="n">P1</span><span class="p">;</span>	<span class="c1">// Target player ID
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="optimizing-bullet-removal">Optimizing Bullet Removal
</h5><p>If bullets are only removed upon collision, those that miss will remain in memory indefinitely—leading to memory leaks. To prevent this, we also check whether a bullet has moved off-screen. This logic is common to all bullet types, so we define a helper method in the base class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="kt">bool</span> <span class="nf">check_if_exceeds_screen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">getwidth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">getheight</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="full-bullet-base-class">Full Bullet Base Class
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">bool</span> <span class="n">is_debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Bullet Base Class
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Bullet</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Bullet</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Bullet</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_collide</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">callback</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">bool</span> <span class="nf">check_collision</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">position</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="c1">// Check if bullet center is inside the target&#39;s bounding box
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">			<span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">			<span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span>
</span></span><span class="line"><span class="cl">			<span class="o">&amp;&amp;</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">is_debug</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">setfillcolor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">setlinecolor</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">rectangle</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">solidcircle</span><span class="p">((</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// Setters and getters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">set_damage</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">damage</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="nf">get_damage</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">damage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_position</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">get_position</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">get_size</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_velocity</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">velocity</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_collide_target</span><span class="p">(</span><span class="n">PlayerID</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">target_id</span> <span class="o">=</span> <span class="n">target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">PlayerID</span> <span class="nf">get_collide_target</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">target_id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_callback</span><span class="p">(</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">callback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_valid</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">valid</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">get_valid</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">check_can_remove</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">can_remove</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">check_if_exceeds_screen</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">getwidth</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">getheight</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">size</span><span class="p">;</span>						
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">damage</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>					
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>				
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">can_remove</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>			
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span> <span class="n">callback</span><span class="p">;</span>		
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">PlayerID</span> <span class="n">target_id</span> <span class="o">=</span> <span class="n">PlayerID</span><span class="o">::</span><span class="n">P1</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-tip">
    <p><em><strong>Note</strong></em>:</p>
<p>In practice, it&rsquo;s rare to design a game object class completely top-down from the start. Class design is often an iterative process—built and refined as the project evolves. We typically start with a rough structure and improve it through trial, error, and usage. Top-down design requires experience and foresight, but with continued practice, you&rsquo;ll become more comfortable and confident in applying this approach.</p></blockquote>
<h4 id="pea-bullet-class-design">Pea Bullet Class Design
</h4><p>The Peashooter character fires only one type of bullet. The difference between normal and special attacks lies in the firing rate. To make the game feel more dynamic, we use three different sound effects and randomly play one when a pea bullet hits its target. This technique is common in game development—for example, footsteps or gunshots often use varied audio clips to make the experience feel more natural and lively.</p>
<p>To implement this, we override the <code>on_collide</code> method in the <code>PeaBullet</code> subclass and add randomized sound playback. Importantly, when overriding a method but still needing to execute the base class logic, we must explicitly call the parent method.</p>
<p>Here’s the complete implementation of the <code>PeaBullet</code> subclass:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// PeaBullet.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">IMAGE</span> <span class="n">img_pea</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Atlas</span> <span class="n">atlas_pea_break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PeaBullet</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Bullet</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">PeaBullet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>	<span class="c1">// Set bullet size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">damage</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">animation_break</span><span class="p">.</span><span class="n">set_atlas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atlas_pea_break</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_break</span><span class="p">.</span><span class="n">set_interval</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_break</span><span class="p">.</span><span class="n">set_loop</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_break</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span> <span class="p">{</span> <span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">PeaBullet</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">delta</span><span class="p">;</span>	 <span class="c1">// Move bullet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_break</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>	<span class="c1">// Play destruction animation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">check_if_exceeds_screen</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_pea</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_break</span><span class="p">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_collide</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_collide</span><span class="p">();</span>	<span class="c1">// Call base class logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play pea_break_1 from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play pea_break_2 from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play pea_break_3 from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Animation</span> <span class="n">animation_break</span><span class="p">;</span>	<span class="c1">// Destruction animation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-note">
    <p>Building on the <code>Bullet</code> base class, the <code>PeaBullet</code> subclass only needs to extend a few unique behaviors to deliver a complete projectile implementation. This elegantly demonstrates the power of <strong>inheritance</strong> in object-oriented design: shared logic lives in the base class, while specialized behavior is layered on top with minimal duplication. It’s a clean, maintainable approach that scales well as new projectile types are introduced.</p></blockquote>
<h4 id="sun-bullet-class-implementation">Sun Bullet Class Implementation
</h4><p>One important detail when implementing the sun bomb is that its explosion animation frames are slightly larger than its idle animation frames. To ensure the explosion renders correctly, we need to align the centers of both animation rectangles. Since EasyX uses the top-left corner as the origin for rendering, we apply a small positional offset during the explosion animation to visually center it.</p>
<img src="plant4.gif" alt="" style="zoom:80%;" />
<p>Unlike the pea bullet, which continues flying after impact to simulate a splash effect, the sun bomb should remain stationary once it explodes. It’s affected by gravity while active, but its explosion animation plays in place.</p>
<p>Here’s the full implementation of the <code>SunBullet</code> class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// SunBullet.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Atlas</span> <span class="n">atlas_sun</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Atlas</span> <span class="n">atlas_sun_explode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Camera</span> <span class="n">main_camera</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SunBullet</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Bullet</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">SunBullet</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">96</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="n">damage</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">animation_idle</span><span class="p">.</span><span class="n">set_atlas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atlas_sun</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_idle</span><span class="p">.</span><span class="n">set_interval</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_atlas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atlas_sun_explode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_interval</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_loop</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span> <span class="p">{</span> <span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//  Calculate offset to center explosion animation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">IMAGE</span><span class="o">*</span> <span class="n">frame_idle</span> <span class="o">=</span> <span class="n">animation_idle</span><span class="p">.</span><span class="n">get_frame</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">IMAGE</span><span class="o">*</span> <span class="n">frame_explode</span> <span class="o">=</span> <span class="n">animation_explode</span><span class="p">.</span><span class="n">get_frame</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">explode_render_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_idle</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">frame_explode</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">explode_render_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_idle</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">()</span> <span class="o">-</span> <span class="n">frame_explode</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">SunBullet</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">velocity</span><span class="p">.</span><span class="n">y</span> <span class="o">+=</span> <span class="n">gravity</span> <span class="o">*</span> <span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_explode</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_idle</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">check_if_exceeds_screen</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_idle</span><span class="p">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_explode</span><span class="p">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">explode_render_offset</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">explode_render_offset</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_collide</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_collide</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">main_camera</span><span class="p">.</span><span class="n">shake</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>	<span class="c1">// Camera shake effect
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play sun_explode from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="kt">float</span> <span class="n">gravity</span> <span class="o">=</span> <span class="mf">1e-3</span><span class="n">f</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Animation</span> <span class="n">animation_idle</span><span class="p">;</span>		
</span></span><span class="line"><span class="cl">	<span class="n">Animation</span> <span class="n">animation_explode</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">explode_render_offset</span><span class="p">;</span>	
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="sun-bullet-ex-class-implementation">Sun Bullet Ex Class Implementation
</h4><p>Sunflower’s special skill summons a massive sun bomb from off-screen. Unlike the standard sun bomb, this projectile is larger, stronger, and unaffected by gravity. It descends slowly, acting as a zoning tool to restrict enemy movement and make smaller bombs easier to land.</p>
<p>To give it a broader hitbox, we override the <code>check_collision</code> method to use rectangle-based collision detection instead of a single center point.</p>
<p>Here’s the full implementation of the <code>SunBulletEx</code> class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// SunBulletEx.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">extern</span> <span class="n">Atlas</span> <span class="n">atlas_sun_ex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Atlas</span> <span class="n">atlas_sun_ex_explode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">extern</span> <span class="n">Camera</span> <span class="n">main_camera</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SunBulletEx</span> <span class="o">:</span> <span class="k">public</span> <span class="n">Bullet</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">SunBulletEx</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">288</span><span class="p">,</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">288</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">damage</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">animation_idle</span><span class="p">.</span><span class="n">set_atlas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atlas_sun_ex</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_idle</span><span class="p">.</span><span class="n">set_interval</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_atlas</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atlas_sun_ex_explode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_interval</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_loop</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">animation_explode</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span> <span class="p">{</span> <span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Calculate offset to center explosion animation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">IMAGE</span><span class="o">*</span> <span class="n">frame_idle</span> <span class="o">=</span> <span class="n">animation_idle</span><span class="p">.</span><span class="n">get_frame</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">IMAGE</span><span class="o">*</span> <span class="n">frame_explode</span> <span class="o">=</span> <span class="n">animation_explode</span><span class="p">.</span><span class="n">get_frame</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">explode_render_offset</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_idle</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">()</span> <span class="o">-</span> <span class="n">frame_explode</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">explode_render_offset</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">frame_idle</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">()</span> <span class="o">-</span> <span class="n">frame_explode</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">())</span> <span class="o">/</span> <span class="mf">2.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">SunBulletEx</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_explode</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_idle</span><span class="p">.</span><span class="n">on_update</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">check_if_exceeds_screen</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="n">can_remove</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_idle</span><span class="p">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">animation_explode</span><span class="p">.</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">explode_render_offset</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">explode_render_offset</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_collide</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Bullet</span><span class="o">::</span><span class="n">on_collide</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">main_camera</span><span class="p">.</span><span class="n">shake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">350</span><span class="p">);</span>	
</span></span><span class="line"><span class="cl">		<span class="n">mciSendString</span><span class="p">(</span><span class="n">_T</span><span class="p">(</span><span class="s">&#34;play sun_explode_ex from 0&#34;</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">check_collision</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">position</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">bool</span> <span class="n">is_collide_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">-</span> <span class="n">min</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">bool</span> <span class="n">is_collide_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">-</span> <span class="n">min</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">size</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">is_collide_x</span> <span class="o">&amp;&amp;</span> <span class="n">is_collide_y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Animation</span> <span class="n">animation_idle</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Animation</span> <span class="n">animation_explode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Vector2</span> <span class="n">explode_render_offset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-note">
    <p>From a design perspective, the super sun bomb could inherit from the standard sun bomb to reduce duplication. However, this project opts for a flatter inheritance structure to keep the codebase easier to read and maintain.</p></blockquote>
<h4 id="skill-system">Skill System
</h4><p>To implement character skills, we define two virtual methods in the <code>Player</code> base class:  <code>virtual void on_attack</code> and <code>virtual void on_attack_ex</code>. Each player subclass overrides these methods to implement its own normal and special attack logic. This keeps the skill system extensible and cleanly separated across character types.</p>
<h5 id="attack-cooldown-implementation">Attack Cooldown Implementation
</h5><p>Most characters in action games have a cooldown period between normal attacks. During this time, pressing the attack key has no effect. To implement this, we define a boolean flag <code>can_attack</code> to indicate whether the character is currently allowed to perform a normal attack. We also use a timer to track the cooldown duration, represented by an <code>int</code> value in milliseconds.</p>
<p>The logic is simple:</p>
<ul>
<li>When an attack input is received, check if <code>can_attack</code> is true.</li>
<li>If so, flip the flag to false and start the cooldown timer.</li>
<li>Once the timer completes, reset <code>can_attack</code> to true.</li>
</ul>
<p>This ensures that attacks can only be triggered after the cooldown period has passed.</p>
<h4 id="invulnerability-state-implementation">Invulnerability State Implementation
</h4><p>To implement temporary invincibility (often triggered after taking damage), we use two boolean flags:</p>
<ul>
<li><code>bool is_invulnerable = false;</code> — indicates whether the character is currently invincible.</li>
<li><code>bool is_showing_sketch_frame = false;</code> — controls whether the character should render as a white silhouette for visual feedback.</li>
</ul>
<img src="plant5.gif" alt="" style="zoom:80%;" />
<p>We use two timers to manage the invulnerability logic:</p>
<ul>
<li><code>timer_invulnerable</code> — controls the duration of invincibility.</li>
<li><code>timer_invulnerable_blink</code> — toggles between normal and sketch-frame rendering to create a blinking effect.</li>
</ul>
<p>Here’s how these timers are initialized in the <code>Player</code> constructor:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Player</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">current_animation</span> <span class="o">=</span> <span class="n">is_facing_right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Initialize attack cooldown timer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">timer_attack_cd</span><span class="p">.</span><span class="n">set_wait_time</span><span class="p">(</span><span class="n">attack_cd</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">timer_attack_cd</span><span class="p">.</span><span class="n">set_one_shot</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">timer_attack_cd</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">can_attack</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Initialize invulnerability timer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">timer_invulnerable</span><span class="p">.</span><span class="n">set_wait_time</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">timer_invulnerable</span><span class="p">.</span><span class="n">set_one_shot</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">timer_invulnerable</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">is_invulnerable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">is_showing_sketch_frame</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Ensure sketch frame is disabled when invulnerability ends
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">});</span>
</span></span><span class="line"><span class="cl">		<span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Initialize blink timer for invulnerability animation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">timer_invulnerable_blink</span><span class="p">.</span><span class="n">set_wait_time</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">timer_invulnerable_blink</span><span class="p">.</span><span class="n">set_callback</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">is_showing_sketch_frame</span> <span class="o">=</span> <span class="o">!</span><span class="n">is_showing_sketch_frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">});</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To render the character as a white silhouette during invulnerability, we add a utility function in <code>Util.h</code>. This function processes the image’s pixel buffer and sets all pixels to white. For a detailed explanation, refer to the bonus section of the article <a class="link" href="https://nullshowjl.github.io/en/p/c-game-dev-from-scratchteyvat-survivors/"  target="_blank" rel="noopener"
    ><em><strong>Teyvat Survivors</strong></em></a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Util.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sketch_image</span><span class="p">(</span><span class="n">IMAGE</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="n">IMAGE</span><span class="o">*</span> <span class="n">dst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">getwidth</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">getheight</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Resize</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">DWORD</span><span class="o">*</span> <span class="n">src_buffer</span> <span class="o">=</span> <span class="n">GetImageBuffer</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">DWORD</span><span class="o">*</span> <span class="n">dst_buffer</span> <span class="o">=</span> <span class="n">GetImageBuffer</span><span class="p">(</span><span class="n">dst</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">h</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="n">w</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">dst_buffer</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">BGR</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">src_buffer</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF000000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In the <code>on_update</code> method, we update all timers accordingly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="c1">// Whether to render the sketch (silhouette) image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Only generate the sketch frame when the player is invulnerable and blinking
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">is_showing_sketch_frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">sketch_image</span><span class="p">(</span><span class="n">current_animation</span><span class="o">-&gt;</span><span class="n">get_frame</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">img_sketch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We apply the sketch rendering logic inside the <code>on_draw</code> method:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">virtual</span> <span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">hp</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">is_invulnerable</span> <span class="o">&amp;&amp;</span> <span class="n">is_showing_sketch_frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">img_sketch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="n">current_animation</span><span class="o">-&gt;</span><span class="n">on_draw</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To activate invulnerability after taking damage, we add a dedicated method to the <code>Player</code> class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">make_invulnerable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_invulnerable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">timer_invulnerable</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">is_showing_sketch_frame</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>    <span class="c1">// Immediately enter sketch frame mode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">timer_invulnerable_blink</span><span class="p">.</span><span class="n">restart</span><span class="p">();</span> <span class="c1">// Start blinking effect
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, inside the <code>move_and_collide</code> method, we update the bullet collision logic to trigger invulnerability when the player is hit:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">// Player.h
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">move_and_collide</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">is_invulnerable</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="n">Bullet</span><span class="o">*</span> <span class="nl">bullet</span> <span class="p">:</span> <span class="n">bullet_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bullet</span><span class="o">-&gt;</span><span class="n">get_valid</span><span class="p">()</span> <span class="o">||</span> <span class="n">bullet</span><span class="o">-&gt;</span><span class="n">get_collide_target</span><span class="p">()</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">bullet</span><span class="o">-&gt;</span><span class="n">check_collision</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">make_invulnerable</span><span class="p">();</span>		<span class="c1">// Activate invulnerability
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				<span class="n">bullet</span><span class="o">-&gt;</span><span class="n">on_collide</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">bullet</span><span class="o">-&gt;</span><span class="n">set_valid</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">hp</span> <span class="o">-=</span> <span class="n">bullet</span><span class="o">-&gt;</span><span class="n">get_damage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ......
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>	
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="particle-system-implementation">Particle System Implementation
</h3><p>A <strong>particle system</strong> is a technique that uses large numbers of small graphical elements (particles) to simulate complex visual effects like smoke, fire, rain, or explosions. When designing a particle system, we typically break it down into two components:</p>
<ul>
<li><strong>Particle objects</strong>: Represent individual particles, each with properties like animation, physics, and lifespan.</li>
<li><strong>Particle emitters</strong>: Control how particles are generated—frequency, direction, initial velocity, etc.</li>
</ul>
<p>In this project, we implement a lightweight particle system. Each particle behaves like a specialized animated object. Unlike characters or bullets, particles remain fixed in world space once emitted. After their animation finishes, they expire and are removed from the scene.</p>
<p>Here’s the complete <code>Particle</code> class:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Particle</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Particle</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Particle</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">position</span><span class="p">,</span> <span class="n">Atlas</span><span class="o">*</span> <span class="n">atlas</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lifespan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="o">:</span> <span class="n">position</span><span class="p">(</span><span class="n">position</span><span class="p">),</span> <span class="n">atlas</span><span class="p">(</span><span class="n">atlas</span><span class="p">),</span> <span class="n">lifespan</span><span class="p">(</span><span class="n">lifespan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Particle</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_update</span><span class="p">(</span><span class="kt">int</span> <span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">timer</span> <span class="o">+=</span> <span class="n">delta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">timer</span> <span class="o">&gt;=</span> <span class="n">lifespan</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">idx_frame</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">idx_frame</span> <span class="o">&gt;=</span> <span class="n">atlas</span><span class="o">-&gt;</span><span class="n">get_size</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">idx_frame</span> <span class="o">=</span> <span class="n">atlas</span><span class="o">-&gt;</span><span class="n">get_size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">valid</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">on_draw</span><span class="p">(</span><span class="k">const</span> <span class="n">Camera</span><span class="o">&amp;</span> <span class="n">camera</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">putimage_alpha</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">atlas</span><span class="o">-&gt;</span><span class="n">get_image</span><span class="p">(</span><span class="n">idx_frame</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_atlas</span><span class="p">(</span><span class="n">Atlas</span><span class="o">*</span> <span class="n">new_atlas</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">atlas</span> <span class="o">=</span> <span class="n">new_atlas</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_position</span><span class="p">(</span><span class="k">const</span> <span class="n">Vector2</span><span class="o">&amp;</span> <span class="n">new_position</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">set_lifespan</span><span class="p">(</span><span class="kt">int</span> <span class="n">ms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">lifespan</span> <span class="o">=</span> <span class="n">ms</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="nf">check_valid</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">valid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>			<span class="c1">// Frame timer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">lifespan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="c1">// Duration per frame in milliseconds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">idx_frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="c1">// Current animation frame index
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vector2</span> <span class="n">position</span><span class="p">;</span>		<span class="c1">// World-space position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>		<span class="c1">// Whether the particle is still active
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Atlas</span><span class="o">*</span> <span class="n">atlas</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>	<span class="c1">// Animation atlas
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="overall-code-review-and-source-code">Overall Code Review and Source Code
</h2><h3 id="scene-base-class">Scene Base Class
</h3><p>This project introduces the concept of scene management for the first time. Each stage or interface in the game corresponds to a distinct scene. In the base class <code>Scene.h</code>, the <code>on_enter</code> and <code>on_exit</code> methods handle scene initialization and teardown respectively. The <code>on_input</code>, <code>on_update</code>, and <code>on_draw</code> methods correspond to the input, update, and rendering phases of the main loop, each receiving the necessary parameters. Subclasses only need to override these methods to implement their own logic.</p>
<p>The scene manager controls which scene is currently active. When switching scenes, we use an enum to abstract away direct scene pointers. The manager itself also exposes <code>on_input</code>, <code>on_update</code>, and <code>on_draw</code> methods that delegate to the current scene instance.</p>
<h3 id="main-function">Main Function
</h3><p>In <code>main.cpp</code>, we implement two core responsibilities: <strong>resource loading</strong> and <strong>game entry point</strong>. First, we load pixel fonts and animation assets, including mirrored versions for directional rendering. Then we load background music and sound effects. In the entry function, we initialize resources, instantiate the initial scene, and invoke the scene manager’s lifecycle methods within the main game loop.</p>
<h3 id="atlas-class">Atlas Class
</h3><p>For animation handling, we encapsulate an <code>Atlas</code> class that acts as a container for loading and storing image sequences. The <code>Animation</code> class is a lightweight manager that tracks playback progress. It doesn’t store image data directly—instead, it queries the atlas for the current frame. The animation class also handles frame intervals, looping, and end-of-playback callbacks.</p>
<h3 id="camera-class">Camera Class
</h3><p>Rendering uses a custom <code>Camera</code> class that serves as an anchor for relative positioning. By randomly jittering the camera’s position within a small range, we simulate a screen shake effect. To simplify camera-based rendering, we overload utility functions in <code>Util.h</code> for alpha blending, image flipping, and generating white silhouette effects.</p>
<h3 id="timer-and-vector2-classes">Timer and Vector2 Classes
</h3><p>Two foundational utility classes support the framework: <code>Timer</code> and <code>Vector2</code>. The <code>Timer</code> class tracks elapsed time and triggers callbacks when a preset duration is reached. The <code>Vector2</code> class handles 2D vector math, including overloaded arithmetic operators, length calculation, and normalization.</p>
<h3 id="scene-subclasses-menuscene-selectorscene-gamescene">Scene Subclasses: MenuScene, SelectorScene, GameScene
</h3><p>The game starts in the menu scene, which simply plays music and handles scene transitions. The character selection scene uses hardcoded layout logic to render UI elements, dynamically draws character previews based on player choices, and handles input for both players using separate key mappings. Upon exiting the selection scene, we instantiate the chosen characters and assign their avatars and player IDs, which are defined in <code>PlayerID.h</code>.</p>
<p>The in-game scene handles three main areas:</p>
<ul>
<li>World elements like background and platforms</li>
<li>Player-related elements like characters and bullets</li>
<li>Game state elements like health tracking and victory conditions</li>
</ul>
<p>Debug mode toggling is also managed within the game scene.</p>
<h3 id="player-base-class">Player Base Class
</h3><p>The <code>Player</code> base class encapsulates shared logic for all characters. Visually, players have animations for idle, running, attacking, and dying, along with particle effects for jumping, landing, and running. Logically, normal and special attacks are controlled via cooldown timers and energy values. Movement actions like jumping and landing are wrapped in dedicated methods for easy triggering and animation updates.</p>
<p>Damage triggers a brief invulnerability period with a blinking visual effect, managed by timers. Physics simulation is handled in the <code>move_and_collide</code> method, which updates position based on gravity and velocity, and performs collision checks with platforms and bullets.</p>
<h3 id="peashooter-and-sunflower-subclasses">Peashooter and Sunflower Subclasses
</h3><p>With the base class in place, implementing the Peashooter is straightforward—just configure its animations and define bullet spawning logic. We also use randomized sound effects to enhance feedback.</p>
<p>Sunflower follows a similar pattern, but its special attack includes an extra “sun” animation above the character’s head, requiring a custom rendering override.</p>
<h3 id="bullet-base-class">Bullet Base Class
</h3><p>Bullets are abstracted via the <code>Bullet</code> base class. Like players, bullets move through the scene and may be affected by gravity. We track velocity and update position accordingly. Bullets also store damage values, target IDs, and collision callbacks.</p>
<h3 id="peabullet-sunbullet-and-sunbulletex-subclasses">PeaBullet, SunBullet, and SunBulletEx Subclasses
</h3><p>The PeaBullet subclass overrides the collision method to play randomized sound effects and switches rendering logic based on whether the bullet has shattered. The SunBullet simulates gravity until impact, then plays an explosion animation with center alignment adjustments. The SunBulletEx is larger and stronger, descending at a constant speed rather than accelerating under gravity.</p>
<h3 id="particle-class">Particle Class
</h3><p>Particles are treated as lightweight animated objects. Once their animation finishes, they expire and are removed from the scene. Their update logic closely resembles that of the <code>Animation</code> class.</p>
<h3 id="platform-class">Platform Class
</h3><p>Platforms are represented as horizontal lines in world space. For rendering, we use image assets and optionally draw debug overlays depending on the debug mode.</p>
<h3 id="statusbar-class">StatusBar Class
</h3><p>Each player’s status bar consists of three components: avatar, health bar, and energy bar. During gameplay, we continuously read these values from the player object and render them in the UI.</p>
<p>With that, this project’s notes are complete.</p>
<h3 id="full-source-code">Full Source Code
</h3><p><a class="link" href="https://github.com/NullshowJL/Game-Plant-Star-Brawl"  target="_blank" rel="noopener"
    >on GitHub</a></p>
<h2 id="reflection-and-summary">Reflection and Summary
</h2><p>This was my first time studying how a complete game project is designed from the top down. At the beginning, the framework felt abstract and hard to grasp—especially without something like the gameplay layer to test things frequently and intuitively. I often felt unsure of whether I was on the right track. But once the foundational structure was in place, building out the gameplay layer became a smooth and satisfying process. Everything started to click into place.</p>
<p>Even with the experience I gained from the previous <em>Teyvat Survivor</em> project, this one was filled with intricate implementation details. A single oversight could easily lead to unexpected bugs. Some of the design ideas would have been difficult—or even impossible—for me to come up with on my own without falling into common pitfalls. Thankfully, the instructor’s explanations were clear, and the code was clean and easy to follow, which made the learning process much more approachable.</p>
<p>This project made me realize once again where I currently stand in my programming journey: just when I feel like I’ve understood something, I discover how much more there is that I don’t know. And that’s okay. It’s a reminder to keep sharpening my skills and stay committed to continuous learning.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/en/tags/game-dev/">Game Dev</a>
        
            <a href="/en/tags/c&#43;&#43;/">C&#43;&#43;</a>
        
            <a href="/en/tags/easyx/">EasyX</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-copyright">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-clock">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            Last updated on Oct 16, 2025 22:22 &#43;0200
        </span>
    </section></footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/en/p/c-game-dev-from-scratchplant-star-brawl-framework-design/">
        
        
            <div class="article-image">
                <img src="/en/p/c-game-dev-from-scratchplant-star-brawl-framework-design/cover.b4ac8d23547e58b8fea55b0948769665_hu_14c732af37c360d2.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43; Game Dev from Scratch】Plant Star Brawl - Framework Design"
                        
                        data-hash="md5-tKyNI1R&#43;WLj&#43;pVsJSHaWZQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C&#43;&#43; Game Dev from Scratch】Plant Star Brawl - Framework Design</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/c-game-dev-from-scratchteyvat-survivors/">
        
        
            <div class="article-image">
                <img src="/en/p/c-game-dev-from-scratchteyvat-survivors/cover.2074225f101a4c9d2f4143010a76f8b3_hu_b0a14c165a37bd82.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43; Game Dev from Scratch】Teyvat Survivors"
                        
                        data-hash="md5-IHQiXxAaTJ0vQUMBCnb4sw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C&#43;&#43; Game Dev from Scratch】Teyvat Survivors</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/c-game-dev-from-scratchfundamental/">
        
        
            <div class="article-image">
                <img src="/en/p/c-game-dev-from-scratchfundamental/cover.c9643ba4458d00df827006ed1c8182aa_hu_6768cc0990888c2b.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43; Game Dev from Scratch】Fundamental"
                        
                        data-hash="md5-yWQ7pEWNAN&#43;CcAbtHIGCqg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C&#43;&#43; Game Dev from Scratch】Fundamental</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/c-syntaxsmart-pointer/">
        
        
            <div class="article-image">
                <img src="/en/p/c-syntaxsmart-pointer/cover.c2d6bbaddbba8a5650d918e15736971f_hu_6021b341494e9474.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【C&#43;&#43; Syntax】Smart Pointer"
                        
                        data-hash="md5-wta7rdu6ilZQ2RjhVzaXHw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【C&#43;&#43; Syntax】Smart Pointer</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/english-for-developersexpressions-for-dev-life/">
        
        
            <div class="article-image">
                <img src="/en/p/english-for-developersexpressions-for-dev-life/cover.6fcf406002e44b12aac9dbd6ca56d67c_hu_1b739d5272377acb.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【English for Developers】Expressions for Dev Life"
                        
                        data-hash="md5-b89AYALkSxKqydvWylbWfA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【English for Developers】Expressions for Dev Life</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
       
    <section class="totalcount">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        发表了7篇文章 ·
        总计3万0千字
        <br>
    </section>


    
    <section class="running-time">
        本博客已运行
        <span id="runningdays" class="running-days"></span>
    </section>

    <section class="copyright">
        &copy;
        
        2025 Nullshow
    </section>

    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
                data-version="3.31.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><script type="text/javascript" src="/ts/custom.755a1a1acaa996ead77338b5a104158d9c984cdb91486ddb4e1650dfa16111d9.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script>
(() => {
    
    if (window.__L2D_WIDGET_INITED__) return;
    window.__L2D_WIDGET_INITED__ = true;

    const cdnPath = "https://cdn.jsdelivr.net/gh/letere-gzj/live2d-widget-v3@main";
    const config = {
        path: {
            homePath: "/",
            modelPath: "https://cdn.jsdelivr.net/gh/NullshowJL/hugo-static-resources@3aa0848/",
            cssPath: '\/waifu\/waifu.css',
            tipsJsonPath: '\/waifu\/waifu-tips.json',
            tipsJsPath: cdnPath + "/waifu-tips.js",
            live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
            live2dSdkPath: cdnPath + "/live2d-sdk.js"
        },
        tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "photo", "info", "quit"],
        drag: { enable: true, direction: ["x", "y"] },
        switchType: "order"
    };

    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(config.path.cssPath, "css"),
            loadExternalResource(config.path.live2dCorePath, "js"),
            loadExternalResource(config.path.live2dSdkPath, "js"),
            loadExternalResource(config.path.tipsJsPath, "js")
        ]).then(() => {
            initWidget({
                waifuPath: config.path.tipsJsonPath,
                cdnPath: config.path.modelPath,
                tools: config.tools,
                dragEnable: config.drag.enable,
                dragDirection: config.drag.direction,
                switchType: config.switchType
            });
        });
    }

    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            } else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }
})();
</script>

<style>
     
    #waifu #waifu-tool,
    #waifu .waifu-tool,
    #waifu .waifu-toolbar,
    #waifu .waifu-tools {
        transform: translateY(-50px);
        z-index: 1001;  
    }
</style>


<style>
    @font-face {
        font-family: 'WenKai';
        src: url(https://nullshowjl.github.io/font/WenKai.ttf) format('truetype');
    }

    @font-face {
        font-family: 'Mate';
        src: url(https://nullshowjl.github.io/font/Mate.ttf) format('truetype');
    }

    @font-face {
        font-family: 'SourceCodePro';
        src: url(https://nullshowjl.github.io/font/SourceCodePro.ttf) format('truetype');
    }

    :root {
        --base-font-family: 'Mate', 'WenKai', sans-serif;
        --code-font-family: 'SourceCodePro';
    }

    body {
        font-family: 'Mate', 'WenKai', sans-serif;
        font-display: swap;
    }

    code,
    pre {
        font-family: var(--code-font-family), monospace;
        white-space: pre;
         
        tab-size: 4;
         
    }
</style>


<style>
  #TableOfContents > ul ul,
  #TableOfContents > ul ol,
  #TableOfContents > ol ul,
  #TableOfContents > ol ol { display: none; }
  #TableOfContents .open { display: block; }
</style>

<script>
    function initTocHide() {
        const toc = document.querySelector(".widget--toc");
        if (!toc) return;

        window.addEventListener("scroll", () => {
            document.querySelectorAll(".open").forEach((ul) => ul.classList.remove("open"));

            const currentLi = document.querySelector(".active-class");
            if (!currentLi) return;

            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open");
            }

            let ul = currentLi.parentElement;
            while (ul && (ul.localName === "ul" || ul.localName === "ol")) {
                ul.classList.add("open");
                ul = ul.parentElement?.parentElement;
            }
        });
    }

    initTocHide();
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        right: left: 60%;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url('https://nullshowjl.github.io/icons/backTop.svg');
        background-size: cover;
    }
</style>

<script>
    function initScrollTop() {
        const rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) return;

        const btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop;
        rightSideBar.appendChild(btn);

        window.onscroll = () => {
            const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
            btn.style.display = scrollTop > 20 ? "block" : "none";
        };
    }

    function backToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
        position: relative;
    }

    .code-show {
        max-height: none !important;
        overflow: visible !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    const codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) return;

    codeBlocks.forEach((codeBlock) => {
      if (codeBlock.querySelector(".code-more-box")) return;
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) return;

      const codeMoreBox = document.createElement("div");
      codeMoreBox.classList.add("code-more-box");

      const codeMoreBtn = document.createElement("span");
      codeMoreBtn.classList.add("code-more-btn");

      const img = document.createElement("img");
      img.classList.add("code-more-img");
      img.src = 'https:\/\/nullshowjl.github.io\/icons\/codeMore.png';

      codeMoreBtn.appendChild(img);
      codeMoreBtn.addEventListener("click", () => {
        codeBlock.classList.add("code-show");
        codeMoreBox.remove();
        window.dispatchEvent(new Event("resize"));
      });

      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox);
    });
  }

  initCodeMoreBox();
</script>


<script defer src="https://cn.vercount.one/js"></script>

<script>
    function showHideView() {
        const viewCounts = document.querySelectorAll("#viewCount");
        if (!viewCounts.length) return;

        const article = document.querySelector(".article-page");
        if (!article) {
            viewCounts.forEach((ele) => {
                ele.style.display = "none";
            });
        }
    }

    showHideView();
</script>





<div id="particles-js"></div>

<script src="https://nullshowjl.github.io/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', 'https:\/\/nullshowjl.github.io\/background\/particlesjs-config.json', function () {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
    #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
</style>


<div id="jsi-flying-fish-container" class="flying-fish-container"></div>

<script src="/js/renderer.js"></script>
<script>
    window.onload = () => {
        if (typeof RENDERER !== 'undefined') {
            RENDERER.init();
        }
    };
</script>


<script>
    (() => {
        const start = new Date('2025-09-14'); 
        const now = new Date();

        let years = now.getFullYear() - start.getFullYear();
        let months = now.getMonth() - start.getMonth();
        let days = now.getDate() - start.getDate();

        if (days < 0) {
            months -= 1;
            const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
            days += prevMonth.getDate();
        }

        if (months < 0) {
            years -= 1;
            months += 12;
        }

        const result = `${years}年${months}月${days}天`;
        const runningEl = document.getElementById('runningdays');
        if (runningEl) {
            runningEl.textContent = result;
        }
    })();
</script>


        
<script>
(() => {
    
    if (window.__L2D_WIDGET_INITED__) return;
    window.__L2D_WIDGET_INITED__ = true;

    const cdnPath = "https://cdn.jsdelivr.net/gh/letere-gzj/live2d-widget-v3@main";
    const config = {
        path: {
            homePath: "/",
            modelPath: "https://cdn.jsdelivr.net/gh/NullshowJL/hugo-static-resources@3aa0848/",
            cssPath: '\/waifu\/waifu.css',
            tipsJsonPath: '\/waifu\/waifu-tips.json',
            tipsJsPath: cdnPath + "/waifu-tips.js",
            live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
            live2dSdkPath: cdnPath + "/live2d-sdk.js"
        },
        tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "photo", "info", "quit"],
        drag: { enable: true, direction: ["x", "y"] },
        switchType: "order"
    };

    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(config.path.cssPath, "css"),
            loadExternalResource(config.path.live2dCorePath, "js"),
            loadExternalResource(config.path.live2dSdkPath, "js"),
            loadExternalResource(config.path.tipsJsPath, "js")
        ]).then(() => {
            initWidget({
                waifuPath: config.path.tipsJsonPath,
                cdnPath: config.path.modelPath,
                tools: config.tools,
                dragEnable: config.drag.enable,
                dragDirection: config.drag.direction,
                switchType: config.switchType
            });
        });
    }

    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            } else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }
})();
</script>

<style>
     
    #waifu #waifu-tool,
    #waifu .waifu-tool,
    #waifu .waifu-toolbar,
    #waifu .waifu-tools {
        transform: translateY(-50px);
        z-index: 1001;  
    }
</style>


<style>
    @font-face {
        font-family: 'WenKai';
        src: url(https://nullshowjl.github.io/font/WenKai.ttf) format('truetype');
    }

    @font-face {
        font-family: 'Mate';
        src: url(https://nullshowjl.github.io/font/Mate.ttf) format('truetype');
    }

    @font-face {
        font-family: 'SourceCodePro';
        src: url(https://nullshowjl.github.io/font/SourceCodePro.ttf) format('truetype');
    }

    :root {
        --base-font-family: 'Mate', 'WenKai', sans-serif;
        --code-font-family: 'SourceCodePro';
    }

    body {
        font-family: 'Mate', 'WenKai', sans-serif;
        font-display: swap;
    }

    code,
    pre {
        font-family: var(--code-font-family), monospace;
        white-space: pre;
         
        tab-size: 4;
         
    }
</style>


<style>
  #TableOfContents > ul ul,
  #TableOfContents > ul ol,
  #TableOfContents > ol ul,
  #TableOfContents > ol ol { display: none; }
  #TableOfContents .open { display: block; }
</style>

<script>
    function initTocHide() {
        const toc = document.querySelector(".widget--toc");
        if (!toc) return;

        window.addEventListener("scroll", () => {
            document.querySelectorAll(".open").forEach((ul) => ul.classList.remove("open"));

            const currentLi = document.querySelector(".active-class");
            if (!currentLi) return;

            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open");
            }

            let ul = currentLi.parentElement;
            while (ul && (ul.localName === "ul" || ul.localName === "ol")) {
                ul.classList.add("open");
                ul = ul.parentElement?.parentElement;
            }
        });
    }

    initTocHide();
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        right: left: 60%;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url('https://nullshowjl.github.io/icons/backTop.svg');
        background-size: cover;
    }
</style>

<script>
    function initScrollTop() {
        const rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) return;

        const btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop;
        rightSideBar.appendChild(btn);

        window.onscroll = () => {
            const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
            btn.style.display = scrollTop > 20 ? "block" : "none";
        };
    }

    function backToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
        position: relative;
    }

    .code-show {
        max-height: none !important;
        overflow: visible !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    const codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) return;

    codeBlocks.forEach((codeBlock) => {
      if (codeBlock.querySelector(".code-more-box")) return;
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) return;

      const codeMoreBox = document.createElement("div");
      codeMoreBox.classList.add("code-more-box");

      const codeMoreBtn = document.createElement("span");
      codeMoreBtn.classList.add("code-more-btn");

      const img = document.createElement("img");
      img.classList.add("code-more-img");
      img.src = 'https:\/\/nullshowjl.github.io\/icons\/codeMore.png';

      codeMoreBtn.appendChild(img);
      codeMoreBtn.addEventListener("click", () => {
        codeBlock.classList.add("code-show");
        codeMoreBox.remove();
        window.dispatchEvent(new Event("resize"));
      });

      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox);
    });
  }

  initCodeMoreBox();
</script>


<script defer src="https://cn.vercount.one/js"></script>

<script>
    function showHideView() {
        const viewCounts = document.querySelectorAll("#viewCount");
        if (!viewCounts.length) return;

        const article = document.querySelector(".article-page");
        if (!article) {
            viewCounts.forEach((ele) => {
                ele.style.display = "none";
            });
        }
    }

    showHideView();
</script>





<div id="particles-js"></div>

<script src="https://nullshowjl.github.io/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', 'https:\/\/nullshowjl.github.io\/background\/particlesjs-config.json', function () {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
    #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
</style>


<div id="jsi-flying-fish-container" class="flying-fish-container"></div>

<script src="/js/renderer.js"></script>
<script>
    window.onload = () => {
        if (typeof RENDERER !== 'undefined') {
            RENDERER.init();
        }
    };
</script>


<script>
    (() => {
        const start = new Date('2025-09-14'); 
        const now = new Date();

        let years = now.getFullYear() - start.getFullYear();
        let months = now.getMonth() - start.getMonth();
        let days = now.getDate() - start.getDate();

        if (days < 0) {
            months -= 1;
            const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
            days += prevMonth.getDate();
        }

        if (months < 0) {
            years -= 1;
            months += 12;
        }

        const result = `${years}年${months}月${days}天`;
        const runningEl = document.getElementById('runningdays');
        if (runningEl) {
            runningEl.textContent = result;
        }
    })();
</script>


    </body>
</html>


