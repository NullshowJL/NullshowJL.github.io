<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="从一个入门级小游戏，学习专业独立游戏开发者如何架构和写一个项目">
<title>【Unity】从一个入门级小游戏学习商业化代码的写法</title>

<link rel='canonical' href='https://nullshowjl.github.io/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/'>

<link rel="stylesheet" href="/scss/style.min.3b99540141ea6d96ea57a2341f6a138640e2de77d5547ecfa3a88330ad283de6.css"><meta property='og:title' content="【Unity】从一个入门级小游戏学习商业化代码的写法">
<meta property='og:description' content="从一个入门级小游戏，学习专业独立游戏开发者如何架构和写一个项目">
<meta property='og:url' content='https://nullshowjl.github.io/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/'>
<meta property='og:site_name' content='Nullshow的技术博客'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Game Dev' /><meta property='article:tag' content='Unity' /><meta property='article:published_time' content='2026-01-31T08:43:30&#43;08:00'/><meta property='article:modified_time' content='2026-02-09T21:33:34&#43;08:00'/><meta property='og:image' content='https://nullshowjl.github.io/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/cover.jpg' />
<meta name="twitter:title" content="【Unity】从一个入门级小游戏学习商业化代码的写法">
<meta name="twitter:description" content="从一个入门级小游戏，学习专业独立游戏开发者如何架构和写一个项目"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://nullshowjl.github.io/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/cover.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
        
        <figure class="site-avatar">
            <a href="/">
                
                

                
                
                <img src="/img/avatar_hu_7adbda40a4f6f680.png" width="300"
                     height="300" class="site-logo" loading="lazy" alt="Avatar">
                
                
            </a>
            
            <span class="emoji">✍️</span>
            
        </figure>
        
        

        <div class="site-meta">
            <h1 class="site-name"><a href="/">Nullshow的技术博客</a></h1>
            <h2 class="site-description">分享和记录我在开发和学习中的笔记、经验和感悟~</h2>
        </div>
    </header><ol class="menu-social">
        
        
        
        <li>
            <a href='https://gitee.com/nullshow'
                target="_blank" 
                title="Gitee" 
               rel="me">
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-hexagon-letter-g" class="icon-tabler-hexagon-letter-g"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.875 6.27a2.225 2.225 0 0 1 1.125 1.948v7.284c0 .809 -.443 1.555 -1.158 1.948l-6.75 4.27a2.269 2.269 0 0 1 -2.184 0l-6.75 -4.27a2.225 2.225 0 0 1 -1.158 -1.948v-7.285c0 -.809 .443 -1.554 1.158 -1.947l6.75 -3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98h-.033z" /><path d="M14 8h-2a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2v-4h-1" /></svg>
                
            </a>
        </li>
        
        
        
        <li>
            <a href='https://github.com/NullshowJL'
                target="_blank" 
                title="GitHub" 
               rel="me">
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-brand-github">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                
            </a>
        </li>
        
        
        
        
        
        <li>
            <a href='/index.xml'
                target="_blank" 
                title="RSS" 
               rel="me">
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-rss" class="icon-tabler-brand-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>
                
            </a>
        </li>
        
    </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-home">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/portfolio/' >
                
                
                
                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-device-gamepad-2" class="icon-tabler-device-gamepad"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5h3.5a5 5 0 0 1 0 10h-5.5l-4.015 4.227a2.3 2.3 0 0 1 -3.923 -2.035l1.634 -8.173a5 5 0 0 1 4.904 -4.019h3.4z" /><path d="M14 15l4.07 4.284a2.3 2.3 0 0 0 3.925 -2.023l-1.6 -8.232" /><path d="M8 9v2" /><path d="M7 10h2" /><path d="M14 10h2" /></svg>
                
                <span>作品集</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-user">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%AD%A6%E4%B9%A0%E5%8E%86%E7%A8%8B/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-trekking" class="icon-tabler-journey"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 4a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M7 21l2 -4" /><path d="M13 21v-4l-3 -3l1 -6l3 4l3 2" /><path d="M10 14l-1.827 -1.218a2 2 0 0 1 -.831 -2.15l.28 -1.117a2 2 0 0 1 1.939 -1.515h1.439l4 1l3 -2" /><path d="M17 12v9" /><path d="M16 20h2" /></svg>
                
                <span>学习历程</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E6%9B%B4%E6%96%B0%E6%97%A5%E5%BF%97/' >
                
                
                
                <!--
unicode: "fea7"
version: "3.1"
-->
<svg
  xmlns="http://www.w3.org/2000/svg"
  width="24"
  height="24"
  viewBox="0 0 24 24"
  fill="none"
  stroke="#000000"
  stroke-width="0.5"
  stroke-linecap="round"
  stroke-linejoin="round"
 class="icon-tabler-logs">
  <path d="M4 12h.01" />
  <path d="M4 6h.01" />
  <path d="M4 18h.01" />
  <path d="M8 18h2" />
  <path d="M8 12h2" />
  <path d="M8 6h2" />
  <path d="M14 6h6" />
  <path d="M14 12h6" />
  <path d="M14 18h6" />
</svg>

                
                <span>更新日志</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-archives">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-search">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-link">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                
                <li id="i18n-switch">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-language">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                        <option value="https://nullshowjl.github.io/en/" >English</option>
                        
                        <option value="https://nullshowjl.github.io/"  selected>中文</option>
                        
                    </select>
                </li>
                
                

                
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-toggle-left">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-toggle-right">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-hash">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#项目简介">项目简介</a></li>
    <li><a href="#学习目标">学习目标</a></li>
    <li><a href="#开发步骤">开发步骤</a></li>
    <li><a href="#思路及关键步骤">思路及关键步骤</a>
      <ol>
        <li><a href="#postprocessing">PostProcessing</a></li>
        <li><a href="#visual-与-logic-分离">visual 与 logic 分离</a></li>
        <li><a href="#代码要尽可能地清晰">代码要尽可能地清晰</a></li>
        <li><a href="#input的方法">Input的方法</a></li>
        <li><a href="#input放的位置">Input放的位置</a></li>
        <li><a href="#坐标系的设定">坐标系的设定</a></li>
        <li><a href="#landing-的实现思路">Landing 的实现思路</a></li>
        <li><a href="#不要使用字符串来识别游戏物体">不要使用字符串来识别游戏物体</a></li>
        <li><a href="#推力特效的实现">推力特效的实现</a></li>
        <li><a href="#timedeltatime-和-timefixeddeltatime"><code>Time.deltaTime</code> 和 <code>Time.fixedDeltaTime</code></a>
          <ol>
            <li><a href="#deltatime-在-update-中的使用"><code>deltaTime</code> 在 <code>Update()</code> 中的使用</a></li>
            <li><a href="#timefixeddeltatime-在-fixedupdate-中的使用"><code>Time.fixedDeltaTime</code> 在 <code>FixedUpdate()</code> 中的使用</a></li>
            <li><a href="#两者的关键区别">两者的关键区别</a></li>
          </ol>
        </li>
        <li><a href="#eventhandler"><code>EventHandler</code></a></li>
        <li><a href="#临时给字体添加颜色的方法">临时给字体添加颜色的方法</a></li>
        <li><a href="#使用状态机来设置游戏的状态">使用状态机来设置游戏的状态</a></li>
        <li><a href="#点击按钮的操作">点击按钮的操作</a></li>
        <li><a href="#level-number-不变化的处理">Level number 不变化的处理</a></li>
        <li><a href="#在关卡开始时展示全景地图">在关卡开始时展示全景地图</a>
          <ol>
            <li><a href="#新建一个空游戏物体-cinemachinecamera2d-挂载脚本">新建一个空游戏物体 CinemachineCamera2D 挂载脚本</a></li>
            <li><a href="#在-gamelevel-里设置放大的值使得每一关的设置都很灵活">在 GameLevel 里设置放大的值，使得每一关的设置都很灵活</a></li>
            <li><a href="#在-gamemanger-中具体设置">在 GameManger 中具体设置</a></li>
            <li><a href="#在镜头切换时实现平滑效果">在镜头切换时实现平滑效果</a></li>
          </ol>
        </li>
        <li><a href="#input-的改进支持多个输入系统">Input 的改进（支持多个输入系统）</a>
          <ol>
            <li><a href="#扩展">扩展</a></li>
            <li><a href="#触屏输入">触屏输入</a></li>
            <li><a href="#joystick输入">JoyStick输入</a></li>
          </ol>
        </li>
        <li><a href="#使用-sceneloader-来管理场景">使用 SceneLoader 来管理场景</a></li>
        <li><a href="#保持背景音乐在关卡切换时不从头播放">保持背景音乐在关卡切换时不从头播放</a></li>
      </ol>
    </li>
    <li><a href="#扩展-1">扩展</a>
      <ol>
        <li><a href="#关于事件的取消注册">关于事件的取消注册</a>
          <ol>
            <li><a href="#相同的生命周期landervisual-和-lander-组件在同一个-gameobject-上">相同的生命周期：LanderVisual 和 lander 组件在同一个 GameObject 上</a></li>
            <li><a href="#同时销毁当-lander-爆炸时整个-gameobject-被禁用">同时销毁：当 lander 爆炸时，整个 GameObject 被禁用</a></li>
            <li><a href="#unity-会在对象销毁时自动清理这些引用">Unity 会在对象销毁时自动清理这些引用</a></li>
          </ol>
        </li>
        <li><a href="#以下情况下必须进行取消注册的操作">以下情况下必须进行取消注册的操作：</a>
          <ol>
            <li><a href="#取消注册的地方">取消注册的地方</a></li>
          </ol>
        </li>
        <li><a href="#visual-和-logic-分开">visual 和 logic 分开</a></li>
        <li><a href="#polish">Polish</a></li>
      </ol>
    </li>
    <li><a href="#复盘和下一步">复盘和下一步</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/">
                <img src="/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/cover_hu_8e572981fef33a16.jpg"
                        srcset="/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/cover_hu_8e572981fef33a16.jpg 800w, /p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/cover_hu_6a8617e5f23fb73d.jpg 1600w"
                        width="800" 
                        height="240" 
                        loading="lazy"
                        alt="Featured image of post 【Unity】从一个入门级小游戏学习商业化代码的写法" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/study-notes/" style="background-color: #2a9d8f; color: #fff;">
                Study Notes
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/unity%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%85%A5%E9%97%A8%E7%BA%A7%E5%B0%8F%E6%B8%B8%E6%88%8F%E5%AD%A6%E4%B9%A0%E5%95%86%E4%B8%9A%E5%8C%96%E4%BB%A3%E7%A0%81%E7%9A%84%E5%86%99%E6%B3%95/">【Unity】从一个入门级小游戏学习商业化代码的写法</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            从一个入门级小游戏，学习专业独立游戏开发者如何架构和写一个项目
        </h3>
        
    </div>

    
    
    
    
<footer class="article-time">
    
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-date">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
        <time class="article-time--published">Jan 31, 2026</time>
    </div>
    

    
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-clock">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <time class="article-time--reading">
            阅读时长: 17 分钟
        </time>
    </div>
    

    
    <div id="viewCount">
        <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-eye" class="icon-tabler-eye"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" /><path d="M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6" /></svg>
        <time class="article-time--reading">
            
            <span id="vercount_value_page_pv">loading... </span> views
        </time>
    </div>

</footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><strong>教程参考及素材来源</strong>：<a class="link" href="https://www.youtube.com/watch?v=nGKd4yTP3M8&amp;t=19395s"  target="_blank" rel="noopener"
    >油管-Code Monkey</a></p>
<h2 id="项目简介">项目简介
</h2><p>《Lua Lander》是一个受经典游戏《Lunar Lander》启发的 2D 物理小游戏，核心玩法是操控小型飞船在外星地表安全着陆。</p>
<p><strong>经典街机游戏《lunar Lander》的主要机制是：</strong></p>
<ul>
<li>使用推力与旋转控制飞船方向与速度</li>
<li>避免高速或倾斜角度着陆，否则会坠毁</li>
<li>在指定着陆点轻柔降落可获得更高分数</li>
<li>需要管理速度、角度与燃料</li>
</ul>
<img src="./0-show.gif" alt="" style="zoom:100%;"/>
<p>《Lua Lander》是油管游戏开发大佬Code Monkey在此基础上做的复刻和扩展。除了保留以上核心机制外，项目的<strong>扩展玩法</strong>包括：</p>
<ul>
<li>更复杂的着陆判定（速度+角度）</li>
<li>多种着陆平台 + 分数倍率系统</li>
<li>燃料系统（飞行成本）</li>
<li>金币收集系统（额外得分）</li>
<li>推进器视觉特效（粒子系统 + 事件驱动）</li>
</ul>
<p>此外，项目还做了<strong>系统级的扩展</strong>：</p>
<ul>
<li>完整 UI 系统</li>
<li>游戏状态机（Start → Playing → GameOver）</li>
<li>多关卡系统（Prefab 关卡，而非多 Scene）</li>
<li>关卡预览（Cinemachine + 自定义 2D Zoom）</li>
<li>多输入系统（键盘 + 手柄 + 触屏）</li>
<li>主菜单、暂停菜单、游戏结束场景</li>
<li>音效与音乐系统</li>
</ul>
<img src="./1-show.gif" alt="" style="zoom:100%;"/>
<h2 id="学习目标">学习目标
</h2><p>Code Monkey喜欢做的游戏一般系统复杂、项目规模大、对可维护性要求高，所以他的教程不管是哪个级别的都会采用更专业的结构，展现如何将clean code、good practice融合进他的项目之中。我希望从这个项目中不仅能学到他解决问题的思路、怎么写干净的代码，还能学到架构项目的正确方式、真正的游戏工程师思维，为以后自己做复杂项目打下基础。</p>
<p>所以在这个项目中我将采用步步跟随的方式，总结他的方法和思路，以便可以用在以后自己的项目中。</p>
<h2 id="开发步骤">开发步骤
</h2><p>整个游戏大概按照下面步骤开发：</p>
<ul>
<li>
<p>post processing处理（可以放在任意步骤）</p>
</li>
<li>
<p>ander的开发</p>
<ul>
<li>lander的运动</li>
<li>动力的视觉效果</li>
</ul>
</li>
<li>
<p>terrain的开发</p>
<ul>
<li>使用sprite shape</li>
</ul>
</li>
<li>
<p>摄像机跟随</p>
<ul>
<li>cinemachine</li>
</ul>
</li>
<li>
<p>背景的设置</p>
</li>
<li>
<p>landing</p>
<ul>
<li>landing的判定</li>
<li>landing在平台上</li>
</ul>
</li>
<li>
<p>landing pad预制体</p>
<ul>
<li>prefab variant （大小不同、得分倍率不同的平台）</li>
<li>得分倍率动态指示</li>
</ul>
</li>
<li>
<p>燃料机制的实现</p>
<ul>
<li>设置燃料额度</li>
<li>lander拾取燃料</li>
<li>金币（与燃料类似）</li>
</ul>
</li>
<li>
<p>GameManager</p>
</li>
<li>
<p>UI</p>
<ul>
<li>数据统计板</li>
<li>加速指示箭头</li>
<li>燃料进度条</li>
<li>游戏结束UI
<ul>
<li>结果和数据统计面板</li>
<li>Restart按钮</li>
</ul>
</li>
</ul>
</li>
<li>
<p>游戏状态设置</p>
<ul>
<li>Start</li>
<li>Restart</li>
<li>Gameover</li>
</ul>
</li>
<li>
<p>爆炸特效</p>
</li>
<li>
<p>新关卡</p>
<ul>
<li>使用prefab的方法</li>
</ul>
</li>
<li>
<p>全景地图</p>
</li>
<li>
<p>Input System</p>
<ul>
<li>button/ Key</li>
<li>Touch</li>
<li>Joy Stick</li>
</ul>
</li>
<li>
<p>Main Menu Scene</p>
</li>
<li>
<p>PauseUI</p>
<ul>
<li>点击按钮</li>
<li>按下 Esc 键</li>
</ul>
</li>
<li>
<p>GameOverScene</p>
<ul>
<li>total score</li>
<li>返回主菜单按钮</li>
</ul>
</li>
<li>
<p>SoundManager 和 MusicManager</p>
<ul>
<li>保持背景音乐在关卡切换后仍然持续播放</li>
<li>音量按钮</li>
</ul>
</li>
<li>
<p>Polish</p>
</li>
</ul>
<h2 id="思路及关键步骤">思路及关键步骤
</h2><h3 id="postprocessing">PostProcessing
</h3><p>可以通过 Volume =&gt; Global Volume =&gt; Add Override 来对游戏中的图片和 Game 界面的背景进行视觉效果的调整。虽然此项目只调整了 Bloom 和 Vignette，但是还有大量的参数可调，到时可以根据需要去探索使用。</p>
<h3 id="visual-与-logic-分离">visual 与 logic 分离
</h3><p>创建一个空游戏物体，将sprite作为子物体挂载在它下面，只负责渲染。而这个空游戏物体会挂载所有的脚本/行为组件，负责所有的逻辑。如果以后有更多的视觉效果（比如粒子特效等），也都同样以单独的子物体的方式挂载。这种做法是我第一次看到的。这样做的好处是：</p>
<ul>
<li>
<p><strong>逻辑与表现解耦，代码更干净</strong></p>
<p>如果逻辑脚本和 Sprite Renderer 在同一个 GameObject 上，你的脚本就会天然依赖视觉组件。分开以后，逻辑脚本只处理数据、状态、行为；子物体负责显示，不影响逻辑。这是“解耦”的核心。</p>
</li>
<li>
<p><strong>更容易替换视觉资源（Sprite → 动画 → 3D 模型）</strong></p>
<p>如果视觉和逻辑绑在一起，你要改脚本、改结构、改引用。如果分开，视觉只是子物体，那么可以直接把子物体删掉换一个新的，而逻辑脚本完全不用动。这对做长期的、需要不断扩展的项目来说非常重要。</p>
</li>
<li>
<p><strong>更容易做动画、旋转、缩放</strong></p>
<p>视觉作为子物体，你可以：</p>
<ul>
<li>让视觉旋转，而逻辑不旋转（例如子弹旋转但逻辑方向不变）</li>
<li>让视觉抖动、缩放，而逻辑位置保持稳定</li>
<li>让视觉做动画，而逻辑不受影响</li>
</ul>
</li>
<li>
<p><strong>碰撞体、逻辑中心点更好控制</strong></p>
<p>逻辑物体通常需要一个“干净的 Transform”来作为移动中心/ 碰撞中心/ 旋转中心/ AI逻辑参考点；而视觉往往不是严格的对齐中心，还需要特别处理。</p>
</li>
<li>
<p><strong>更容易做 Prefab 复用</strong></p>
<p>逻辑 prefab 不变，视觉 prefab 可以换皮肤、换主题、换颜色、换模型等。</p>
</li>
</ul>
<h3 id="代码要尽可能地清晰">代码要尽可能地清晰
</h3><ul>
<li>
<p>访问修饰符要写出来</p>
<p>默认的访问修饰符（如类中的private和接口中的public），Unity并不会显示，也要写上</p>
</li>
</ul>
<h3 id="input的方法">Input的方法
</h3><p>在Unity6 中新旧两套 Input 的方法都可以用:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 老版本</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">GetKey</span><span class="p">(</span><span class="n">KeyCode</span><span class="p">.</span><span class="n">UpArrow</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&#34;Up&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Unity6</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">UpArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="n">Debug</span><span class="p">.</span><span class="n">Log</span><span class="p">(</span><span class="s">&#34;Up&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="input放的位置">Input放的位置
</h3><p>一般来说，需要放在 Update() 里面，因为 Update会每帧监听是否有输入。但是在这个项目中，可以直接放在 FixedUpdate() 里，因为我们使用的是 isPressed，就是说如果一直有按键的动作（isPressed/ GetKey），那么即使在固定帧率（FixedUpdate）监听的情况下，也是可以被检测到的。但是如果使用监听按下/抬起键一瞬间的API（GetKeyDown/ GetKeyUp），那么建议放在 Update 中，因为放在FixedUpdate中可能会错过。</p>
<p>此外，关于物理特性的更新，一律需要放在 FixedUpdate 中。</p>
<blockquote class="alert alert-note">
    <p>如果不得不放在 Update 中，一定要乘以 Time.deltaTime，以确保在不同帧率的计算机上移动的速度是一样的。</p>
<p>虽然在 FixedUp 里无需加上 Time.deltaTime，但是加上也无所谓</p></blockquote>
<h3 id="坐标系的设定">坐标系的设定
</h3><p>由于采用了visual和logic分离的方式，所以要确保坐标系设置为 Pivot 和 Local。因为如果设置为 Center，那么中心点将是子物体和父物体之间的中心位置，设置为 Pivot，中心会是各个物体本身的中心点。</p>
<p>而在此项目中我们希望按下 向上箭头键 后，lander朝着自己本身的上方移动，那么需要将坐标参考设置为 Local。如果设置为 Global，那么不管lander本身朝向何方，我们按下 向上箭头键，lander会永远朝着屏幕上方移动。</p>
<h3 id="landing-的实现思路">Landing 的实现思路
</h3><p>landing的判定有两个层面：</p>
<ul>
<li>飞船需要以保持直立的状态着陆</li>
<li>飞船需要较为轻柔地着陆</li>
</ul>
<p>从着陆的轻重层面，使用 <code>Collision.relativeVelocity)</code>来判断。这是Collision的一个属性，描述两个碰撞对象的相对线性速度（只读）。</p>
<p>着陆角度判定的实现，则使用两个向量（物体本身的向上向量<code>transform.up</code>和世界坐标的向上向量<code>Vector2.up</code>）的点乘值来进行判断。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============ Lander.cs ===========</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">OnCollisionEnter2D</span><span class="p">(</span><span class="n">Collision2D</span> <span class="n">other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">softLandingVelocityMagnitude</span> <span class="p">=</span> <span class="m">3f</span><span class="p">;</span>	<span class="c1">// 根据游戏表现的数值设定</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">relativeVelocity</span><span class="p">.</span><span class="n">magnitude</span> <span class="p">&gt;</span> <span class="n">softLandingVelocityMagnitude</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;Landing too hard!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">minDotVector</span> <span class="p">=</span> <span class="m">0.92f</span><span class="p">;</span>	<span class="c1">// 根据游戏表现的数值设定</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">dotVector</span> <span class="p">=</span> <span class="n">Vector2</span><span class="p">.</span><span class="n">Dot</span><span class="p">(</span><span class="n">Vector2</span><span class="p">.</span><span class="n">up</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">up</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="n">dotVector</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">dotVector</span> <span class="p">&lt;</span> <span class="n">minDotVector</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="s">&#34;landing angle too steep!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;Safe landing!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote class="alert alert-tip">
    <p>如何设定某些判定的值？</p>
<p>如果某些值不知道设置多少合适，可以在 console 中打印出来，然后在游戏中看不同的情况显示不同的值来决定。比如此项目中，关于landing/ crash的判定就是这样做的。</p></blockquote>
<h3 id="不要使用字符串来识别游戏物体">不要使用字符串来识别游戏物体
</h3><p>字符串只能用在文本中，不要用它来查找物体或者使用Unity自带的Tag，因为非常容易出错，比如大小写没搞清、拼错或者不当心在名字后带了一个空格，都会被判定为查找失败。</p>
<blockquote class="alert alert-note">
    <p>使用脚本来查询物体。</p></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">// 识别是否是landing pad</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">TryGetComponent</span><span class="p">&lt;</span><span class="n">LandingPad</span><span class="p">&gt;(</span><span class="k">out</span> <span class="n">LandingPad</span> <span class="n">landingPad</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;landing pad&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="推力特效的实现">推力特效的实现
</h3><p>同样出于解耦的考虑，<code>lander.cs</code> 里不应该有 visual 相关的代码，所以使用事件来处理。</p>
<p>另外，粒子系统和 <code>transform.position</code> 一样是只读的，意味能无法直接修改的，所以需要通过 EmissionModule 来间接得修改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">ParticleSystem</span><span class="p">.</span><span class="n">EmissionModule</span> <span class="n">emissionModule</span> <span class="p">=</span> <span class="n">leftThrusterParticalSystem</span><span class="p">.</span><span class="n">emission</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">emissionModule</span><span class="p">.</span><span class="n">enabled</span> <span class="p">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="timedeltatime-和-timefixeddeltatime"><code>Time.deltaTime</code> 和 <code>Time.fixedDeltaTime</code>
</h3><h4 id="deltatime-在-update-中的使用"><code>deltaTime</code> 在 <code>Update()</code> 中的使用
</h4><p>•	目的：补偿可变帧率
•	<code>Update()</code> 的调用频率取决于帧率（30fps、60fps、144fps 等都不同）
•	<code>deltaTim</code>e 记录每帧的实际时间间隔
•	通过乘以 <code>deltaTime</code>，确保物体在不同帧率下以相同的实际速度移动</p>
<h4 id="timefixeddeltatime-在-fixedupdate-中的使用"><code>Time.fixedDeltaTime</code> 在 <code>FixedUpdate()</code> 中的使用
</h4><p>•	目的：使用固定时间步长进行物理模拟
•	<code>FixedUpdate()</code> 以固定间隔调用（默认 0.02 秒，即 50 次/秒），不受帧率影响
•	<code>Time.fixedDeltaTime</code> 是这个固定值（通常是常量）
•	物理引擎需要固定时间步长来保证模拟的稳定性和可预测性</p>
<h4 id="两者的关键区别">两者的关键区别
</h4><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th></th>
          <th>Update() + deltaTime</th>
          <th>FixedUpdate() + fixedDeltaTime</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>时间间隔</strong></td>
          <td>可变（取决于帧率）</td>
          <td>固定（默认 0.02 秒）</td>
      </tr>
      <tr>
          <td><strong>作用</strong></td>
          <td>补偿帧率差异</td>
          <td>保证物理模拟稳定</td>
      </tr>
      <tr>
          <td><strong>适用场景</strong></td>
          <td>渲染、输入、非物理逻辑</td>
          <td>物理计算、Rigidbody 操作</td>
      </tr>
  </tbody>
</table></div>
<h3 id="eventhandler"><code>EventHandler</code>
</h3><p>因为这个项目规模较小，且 <code>GameManager</code> 统管所有 游戏数据，而且 <code>Lander</code> 又是游戏的核心，所以在 <code>Lander.cs</code> 中使用 <code>GameManager</code>的单例没有问题（<code>Lander</code>与<code>GameManager</code>紧密耦合）。另一种策略是，仍然使用监听的方式，通过 <code>EventHandler</code>让<code>GameManager</code>中的数据根据在 <code>Lander.cs</code>中的监听结果做出反应。此项目采用了第二种方式。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//=============== Lander.cs ===============</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">OnTriggerEnter2D</span><span class="p">(</span><span class="n">Collider2D</span> <span class="n">other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">TryGetComponent</span><span class="p">(</span><span class="k">out</span> <span class="n">CoinPickup</span> <span class="n">coinPickup</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">OnCoinPickup</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">coinPickup</span><span class="p">.</span><span class="n">DestroySelf</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//============== GameManager.cs =============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">GameManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="n">Lander</span> <span class="n">lander</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span> <span class="p">=</span> <span class="n">lander</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Lander</span><span class="p">&gt;();</span> <span class="c1">// 因为是获取另一个无关联的游戏物体的组件，所以放在Start里</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnCoinPickup</span> <span class="p">+=</span> <span class="n">Lander_PickupCoin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Lander_PickupCoin</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">AddScore</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">AddScore</span><span class="p">(</span><span class="kt">int</span> <span class="n">addScoreAmount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="p">+=</span> <span class="n">addScoreAmount</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">print</span><span class="p">(</span><span class="n">score</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>Lander_PickupCoin</code> 中的参数 <code>object sender</code> 和 <code>EventArgs e</code> 即使在方法体内没有被使用，也必须保留在参数列表中。原因是：</p>
<ol>
<li>匹配事件签名：<code>lander.OnCoinPickup</code> 事件期望一个特定格式的处理器方法</li>
<li>C# 事件模式：这是 .NET 的标准事件处理器模式，必须匹配 <code>EventHandler</code> 委托的签名</li>
</ol>
<p>如果移除这些参数，代码将无法编译。</p>
<p><strong>参数的用途：</strong></p>
<p>•	<code>object sender</code>：告诉你是哪个对象触发了事件（这里是 lander 实例）
•	<code>EventArgs e</code>：传递事件数据（比如捡到的金币价值）</p>
<p>如果需要明确表示“不需要使用这些参数”，可以用“弃元（Discards）”的写法表示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">Lander_PickupCoin</span><span class="p">(</span><span class="kt">object</span> <span class="n">_</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">AddScore</span><span class="p">(</span><span class="m">500</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>EventHandler 中使用参数的例子</strong></p>
<p>比如，在“根据飞船着陆质量时叠加不同的分数”这一机制的实现上：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//========== Lander.cs ==========</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">event</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">OnLandedEventArgs</span><span class="p">&gt;</span> <span class="n">OnLanded</span><span class="p">;</span>     <span class="c1">// 不同着陆效果有不同的分数，所以给EventArgs传入一个分数的参数</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">OnLandedEventArgs</span> <span class="p">:</span> <span class="n">EventArgs</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 飞船在平台上的着陆</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">OnCollisionEnter2D</span><span class="p">(</span><span class="n">Collision2D</span> <span class="n">other</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">score</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="n">RoundToInt</span><span class="p">(</span><span class="n">landingSpeedScore</span> <span class="p">+</span> <span class="n">landingAngleScore</span><span class="p">)</span> <span class="p">*</span> <span class="n">landingPad</span><span class="p">.</span><span class="n">GetScoreMultiplier</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">print</span><span class="p">(</span><span class="s">&#34;score: &#34;</span> <span class="p">+</span> <span class="n">score</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">OnLanded</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">OnLandedEventArgs</span>	<span class="c1">// 在Invoke时传入score参数</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="p">=</span> <span class="n">score</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//============ GameManager.cs ===========</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">GameManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 实际使用score参数</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Lander_OnLanded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Lander</span><span class="p">.</span><span class="n">OnLandedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">AddScore</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">score</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="临时给字体添加颜色的方法">临时给字体添加颜色的方法
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"> <span class="n">titleTxtMesh</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;&lt;color=#ff0000&gt;CRUSH!&lt;/color&gt;&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用状态机来设置游戏的状态">使用状态机来设置游戏的状态
</h3><p>用<code>enum</code>设置几个游戏状态，然后和按键结合。这个过程在Lander/ Player脚本中完成，还是非常简便的。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============ Lander.cs ============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">State</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WaitingToStart</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Normal</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Gameover</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="kd">private</span> <span class="k">void</span> <span class="n">FixedUpdate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">switch</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="k">default</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="n">State</span><span class="p">.</span><span class="n">WaitingToStart</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">upArrowKey</span><span class="p">.</span><span class="n">isPressed</span> <span class="p">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">rightArrowKey</span><span class="p">.</span><span class="n">isPressed</span> <span class="p">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">leftArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">// 如果任意的键按下</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">// 重力设为正常并跳转到游戏状态</span>
</span></span><span class="line"><span class="cl">                 <span class="n">landerRigidbody2D</span><span class="p">.</span><span class="n">gravityScale</span> <span class="p">=</span> <span class="n">GRAVITY_NORMAL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                 <span class="n">SetState</span><span class="p">(</span><span class="n">State</span><span class="p">.</span><span class="n">Normal</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">             <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="n">State</span><span class="p">.</span><span class="n">Normal</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">fuelAmount</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                 <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">upArrowKey</span><span class="p">.</span><span class="n">isPressed</span> <span class="p">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">rightArrowKey</span><span class="p">.</span><span class="n">isPressed</span> <span class="p">||</span>
</span></span><span class="line"><span class="cl">                <span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">leftArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="n">ConsumeFuel</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">upArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="n">landerRigidbody2D</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">force</span> <span class="p">*</span> <span class="n">transform</span><span class="p">.</span><span class="n">up</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">fixedDeltaTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">// 播放消息</span>
</span></span><span class="line"><span class="cl">                 <span class="n">OnUpForce</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">leftArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="n">landerRigidbody2D</span><span class="p">.</span><span class="n">AddTorque</span><span class="p">(</span><span class="n">turnSpeed</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">fixedDeltaTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                 <span class="n">OnLeftForce</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">             <span class="k">if</span> <span class="p">(</span><span class="n">Keyboard</span><span class="p">.</span><span class="n">current</span><span class="p">.</span><span class="n">rightArrowKey</span><span class="p">.</span><span class="n">isPressed</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">             <span class="p">{</span>
</span></span><span class="line"><span class="cl">                 <span class="n">landerRigidbody2D</span><span class="p">.</span><span class="n">AddTorque</span><span class="p">(-</span><span class="n">turnSpeed</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">fixedDeltaTime</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                 <span class="n">OnRightForce</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">             <span class="p">}</span>
</span></span><span class="line"><span class="cl">             <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">         <span class="k">case</span> <span class="n">State</span><span class="p">.</span><span class="n">Gameover</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">             <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>      
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>爆炸特效的实现</strong>：</p>
<p>同样通过事件的方法完成。但是需要注意的是，它（<code>OnLanded</code>）的注册并没有像推力特效那样直接注册在 <code>Awake</code> 中，而是注册在 <code>Start</code> 中。因为以下三个原因：</p>
<ul>
<li>一次性事件：整个游戏过程只触发一次</li>
<li>可能依赖其他系统：爆炸效果、游戏状态管理等可能需要在其他对象的 Awake() 中初始化</li>
<li>不需要立即准备：着陆不会在游戏开始的瞬间发生</li>
</ul>
<p><strong>总结将爆炸特效放在 <code>Start</code> 中的好处</strong>：</p>
<ol>
<li>代码组织：将初始化逻辑（高频事件）和游戏逻辑（一次性事件）分开</li>
<li>避免潜在问题：如果其他脚本的 <code>Awake()</code> 中也订阅了 <code>OnLanded</code>，使用 <code>Start()</code> 可以确保订阅顺序更可控</li>
</ol>
<h3 id="点击按钮的操作">点击按钮的操作
</h3><p>项目中没有使用“在面板中绑定按钮”的方法，而是直接写在代码中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="na">[SerializeField]</span> <span class="kd">private</span> <span class="n">Button</span> <span class="n">nextBtn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">Awake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">nextBtn</span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(()</span> <span class="p">=&gt;</span>	<span class="c1">// 使用lambda表达式写法，因为没有参数、没有返回值，这样写最简便</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="n">SceneManager</span><span class="p">.</span><span class="n">LoadScene</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在新增了关卡后，使用一个回调函数来决定，点击按钮是进入下一关还是重玩这一关。用Action来存储函数，而不是使用它的事件功能，这种做法很灵活。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//=========== LandedUI.cs ============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">LandedUI</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl"><span class="na">    
</span></span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="n">Button</span> <span class="n">nextBtn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Action</span> <span class="n">nextBtnClickAction</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Awake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">nextBtn</span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(()</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">nextBtnClickAction</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Lander</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">OnLanded</span> <span class="p">+=</span> <span class="n">Lander_OnLanded</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Hide</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Lander_OnLanded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Lander</span><span class="p">.</span><span class="n">OnLandedEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">landingType</span> <span class="p">==</span> <span class="n">Lander</span><span class="p">.</span><span class="n">LandingType</span><span class="p">.</span><span class="n">Success</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">titleTxtMesh</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;SUCCESSFUL LANDING!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">nextBtnClickAction</span> <span class="p">=</span> <span class="n">GameManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">GoToNextLevel</span><span class="p">;</span>	<span class="c1">// 根据不同的情况决定回调哪个函数</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">titleTxtMesh</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="s">&#34;&lt;color=#ff0000&gt;CRUSH!&lt;/color&gt;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">nextBtnClickAction</span> <span class="p">=</span> <span class="n">GameManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">RetryLevel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="level-number-不变化的处理">Level number 不变化的处理
</h3><p>将 <code>levelNumber</code>设置为普通变量，因为在场景重载时会销毁其中的 <code>GameManager</code>，所以会导致场景默认值仍为1，无法进入下一场景的情况。</p>
<p>教程中使用的处理方式是将 levelNumber设置为<code>static</code>，这样它保留在内存中，当场景中所有的东西被新建时，新的<code>GameManager</code>会重新读取到它，从而加载到下一关。</p>
<h3 id="在关卡开始时展示全景地图">在关卡开始时展示全景地图
</h3><p>因为每一关的地图都不一样，所以这个脚本需要挂在每一关上。使用控制<code>CinemachineCamera</code>的方法来切换游戏未开始时和游戏开始时的跟随对象。</p>
<p>由于 Unity 的 <code>Cinemachine 2D（CinemachineVirtualCamera + Framing Transposer 2D）</code>本身没有zoom的功能，所以需要自己写脚本来实现。</p>
<p>而在3D的模式下，CinemachineVirtualCamera 有内建的 Lens → Field of View（FOV）或 Orthographic Size 控制，可以直接当作 Zoom 使用。</p>
<h4 id="新建一个空游戏物体-cinemachinecamera2d-挂载脚本">新建一个空游戏物体 CinemachineCamera2D 挂载脚本
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============== CinemachineCameraZoom2D.cs ===============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">CinemachineCameraZoom2D</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">const</span> <span class="kt">int</span> <span class="n">NORMAL_ORTHOGRAPHIC_SIZE</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">CinemachineCameraZoom2D</span> <span class="n">Instance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="kd">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="na">
</span></span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="n">CinemachineCamera</span> <span class="n">cinemachineCamera</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">float</span> <span class="n">targetOrthographicSize</span> <span class="p">=</span> <span class="m">10f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Awake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cinemachineCamera</span><span class="p">.</span><span class="n">Lens</span><span class="p">.</span><span class="n">OrthographicSize</span> <span class="p">=</span> <span class="n">targetOrthographicSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">SetTargetOrthographicSize</span><span class="p">(</span><span class="kt">float</span> <span class="n">targetOrthographicSize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="n">targetOrthographicSize</span> <span class="p">=</span> <span class="n">targetOrthographicSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="k">void</span> <span class="n">SetNormalOrthographicSize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SetTargetOrthographicSize</span><span class="p">(</span><span class="n">NORMAL_ORTHOGRAPHIC_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="在-gamelevel-里设置放大的值使得每一关的设置都很灵活">在 GameLevel 里设置放大的值，使得每一关的设置都很灵活
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============== GameLevel.cs ===============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">GameLevel</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="kt">float</span> <span class="n">zoomedOutOrthographicSize</span><span class="p">;</span>   <span class="c1">// 这个值放在GameLevel里，这样每个level都可以自由设置</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">float</span> <span class="n">GetZoomOutOrthographicSize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">zoomedOutOrthographicSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="在-gamemanger-中具体设置">在 GameManger 中具体设置
</h4><p>在关卡刚加载、玩家还未开始游戏时让 Cinemachine zoom out，显示全景；当玩家按下按键游戏开始时，设置Cinemachine的镜头范围恢复正常。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============== GameManager.cs ==============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">GameManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> 	<span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">LoadCurrentLevel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">foreach</span> <span class="p">(</span><span class="n">GameLevel</span> <span class="n">level</span> <span class="k">in</span> <span class="n">gameLevelList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">level</span><span class="p">.</span><span class="n">GetLevelNumber</span><span class="p">()</span> <span class="p">==</span> <span class="n">levelNumber</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">GameLevel</span> <span class="n">spawnedLevel</span> <span class="p">=</span> <span class="n">Instantiate</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Lander</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">spawnedLevel</span><span class="p">.</span><span class="n">GetLanderStartingPos</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="c1">// 用 cinemachine 展示地图</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 本质就是将cinemachine的tracking target设置到地图中心</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// 而不是一开始就跟随lander</span>
</span></span><span class="line"><span class="cl">                <span class="n">cinemachineCamera</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">TrackingTarget</span> <span class="p">=</span> <span class="n">spawnedLevel</span><span class="p">.</span><span class="n">GetCameraStartTargetTransform</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// zoom out</span>
</span></span><span class="line"><span class="cl">                <span class="n">CinemachineCameraZoom2D</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">SetTargetOrthographicSize</span><span class="p">(</span><span class="n">spawnedLevel</span><span class="p">.</span><span class="n">GetZoomOutOrthographicSize</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Lander_OnStateChange</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">Lander</span><span class="p">.</span><span class="n">OnStateChangeEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 在游戏正常启动后，cinemachine继续跟随lander</span>
</span></span><span class="line"><span class="cl">        <span class="n">cinemachineCamera</span><span class="p">.</span><span class="n">Target</span><span class="p">.</span><span class="n">TrackingTarget</span> <span class="p">=</span> <span class="n">Lander</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 取消zoom out， 镜头恢复正常设置</span>
</span></span><span class="line"><span class="cl">        <span class="n">CinemachineCameraZoom2D</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">SetNormalOrthographicSize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="在镜头切换时实现平滑效果">在镜头切换时实现平滑效果
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============== CinemachineCameraZoom2D.cs ===============</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 实现镜头转换的平滑效果，使用Lerp</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">zoomSpeed</span> <span class="p">=</span> <span class="m">2f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cinemachineCamera</span><span class="p">.</span><span class="n">Lens</span><span class="p">.</span><span class="n">OrthographicSize</span> <span class="p">=</span> 
</span></span><span class="line"><span class="cl">        <span class="n">Mathf</span><span class="p">.</span><span class="n">Lerp</span><span class="p">(</span><span class="n">cinemachineCamera</span><span class="p">.</span><span class="n">Lens</span><span class="p">.</span><span class="n">OrthographicSize</span><span class="p">,</span> <span class="n">targetOrthographicSize</span><span class="p">,</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span> <span class="p">*</span> <span class="n">zoomSpeed</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="input-的改进支持多个输入系统">Input 的改进（支持多个输入系统）
</h3><ol>
<li>自己创建 InputActions =&gt; Edit Asset =&gt; Action Maps，在Action Maps中为 Player 添加输入，对 player 的三种操作（up/ left/ right）绑定对应的按键：</li>
</ol>
<img src="./2-input.webp" alt="" style="zoom:70%;"/>
<p>然后在面板上勾选创建C# class，这样可以直接通过脚本控制，是Code Monkey推荐的方法，而不是使用字符串。由此，我们自己创建的InputActions生成了一个自己的C#脚本。</p>
<ol start="2">
<li>创建自己的GameInput脚本</li>
</ol>
<p>新建一个空游戏物体，在该物体上挂载一个新的脚本。这个脚本作为中间层，避免其他脚本直接依赖 InputActions.cs (紧密耦合)。这样的好处有：</p>
<ul>
<li>解耦 - 游戏逻辑不直接依赖 InputActions 实现</li>
<li>统一入口 - 所有输入通过一个地方管理</li>
<li>易于测试 - 可以轻松模拟输入（Mock GameInput）</li>
<li>灵活扩展 - 未来想添加输入记录、重放功能时只需修改 GameInput</li>
</ul>
<h4 id="扩展">扩展
</h4><h5 id="旧输入系统的缺点">旧输入系统的缺点
</h5><p>Unity的旧输入系统（Input.GetKey(), Input.GetAxis()等）存在以下问题：</p>
<ul>
<li>硬编码输入检测 - 代码中直接写死键位（如 Input.GetKey(KeyCode.W)）</li>
<li>难以重新绑定 - 玩家无法自定义键位</li>
<li>多设备支持差 - 处理手柄、触摸屏等不同设备很复杂</li>
<li>缺乏灵活性 - 输入逻辑分散在各处，难以维护</li>
</ul>
<h5 id="新-input-system的优势">新 Input System的优势
</h5><p>InputActions 提供：</p>
<ul>
<li>配置驱动 - 通过可视化编辑器配置输入，无需修改代码</li>
<li>设备无关 - 同一个Action可以同时支持键盘、手柄、触摸</li>
<li>易于重新绑定 - 运行时动态修改键位</li>
<li>更好的性能 - 事件驱动而非每帧轮询</li>
</ul>
<h5 id="良好实践">良好实践
</h5><p>因为输入的本质也是一种实践，所以需要相应地调用 Enable 和 Disable ：</p>
<p>当调用Enable时，内部会发生：</p>
<ul>
<li>向 Unity 的输入系统注册监听器</li>
<li>开始接收来自硬件的输入事件（键盘、手柄等）</li>
<li>消耗系统资源和内存</li>
</ul>
<p>当调用Disable时，内部会发生：</p>
<ul>
<li>取消所有监听器的注册</li>
<li>停止处理输入事件</li>
<li>释放相关资源</li>
</ul>
<h4 id="触屏输入">触屏输入
</h4><p>GamePad 的绑定和键盘绑定没有区别。触屏输入稍有区别。</p>
<ol>
<li>在 Canvas 中新建一个空游戏物体 TouchUI</li>
<li>在 TouchUI 下面创建三个 UIImage 的圆</li>
<li>给三个圆设置 On-Screen Button 组件</li>
<li>可以通过simulator来查看在不同触摸设备上的效果</li>
</ol>
<img src="./3-simulator.webp" alt="" style="zoom:70%;"/>
<h4 id="joystick输入">JoyStick输入
</h4><p>不同于按键，手柄的 Action 类型要选择 Value =&gt; Vector2。</p>
<img src="./4-joystick.webp" alt="" style="zoom:70%;"/>
<p>然后和按键的输入一样，在相应的脚本中添加即可。</p>
<h3 id="使用-sceneloader-来管理场景">使用 SceneLoader 来管理场景
</h3><p>为了避免在加载场景时使用“magic number” <code>SceneManager.LoadScene(0);</code>，我们使用脚本来控制场景的加载。</p>
<p>因为它会在全局存在，所以将之设置为一个无需继承 MonoBehavior 的静态类。注意，这样一来，类里的所有成员都必须是静态的。</p>
<p>此外，教程中为了避免使用 magic number 和直接使用 string，采用了将场景设置为 enum 的策略。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="c1">//============ MainMenuUI.cs ============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">MainMenuUI</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="n">Button</span> <span class="n">playBtn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="na">    [SerializeField]</span> <span class="kd">private</span> <span class="n">Button</span> <span class="n">quitBtn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Awake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">playBtn</span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(()</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">SceneLoader</span><span class="p">.</span><span class="n">LoadScene</span><span class="p">(</span><span class="n">SceneLoader</span><span class="p">.</span><span class="n">Scene</span><span class="p">.</span><span class="n">GameScene</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">quitBtn</span><span class="p">.</span><span class="n">onClick</span><span class="p">.</span><span class="n">AddListener</span><span class="p">(()</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Application</span><span class="p">.</span><span class="n">Quit</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//============== SceneLoader.cs ===============</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="k">class</span> <span class="nc">SceneLoader</span> 
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Scene</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">MainMenuScene</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">GameScene</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="k">void</span> <span class="n">LoadScene</span><span class="p">(</span><span class="n">Scene</span> <span class="n">scene</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SceneManager</span><span class="p">.</span><span class="n">LoadScene</span><span class="p">(</span><span class="n">scene</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="保持背景音乐在关卡切换时不从头播放">保持背景音乐在关卡切换时不从头播放
</h3><p>可以通过将音乐播放的时间设置为静态的来处理。（需要跨越关卡保持统一数据的，此教程中都是通过设置为static来解决）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kd">public</span> <span class="k">class</span> <span class="nc">MusicManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AudioSource</span> <span class="n">musicAudioSource</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">float</span> <span class="n">musicTime</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Awake</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">musicAudioSource</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">musicAudioSource</span><span class="p">.</span><span class="n">time</span> <span class="p">=</span> <span class="n">musicTime</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">musicTime</span> <span class="p">=</span> <span class="n">musicAudioSource</span><span class="p">.</span><span class="n">time</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="扩展-1">扩展
</h2><h3 id="关于事件的取消注册">关于事件的取消注册
</h3><p>在这个项目中多处用到了事件机制来实现代码的解耦，但是绝大多数情况没有进行取消注册的操作。但这并非最佳实践。</p>
<p>在以下情况下，不取消操作暂时是安全的：</p>
<h4 id="相同的生命周期landervisual-和-lander-组件在同一个-gameobject-上">相同的生命周期：LanderVisual 和 lander 组件在同一个 GameObject 上
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">lander</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Lander</span><span class="p">&gt;();</span>  <span class="c1">// 同一个对象</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="同时销毁当-lander-爆炸时整个-gameobject-被禁用">同时销毁：当 lander 爆炸时，整个 GameObject 被禁用
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">gameObject</span><span class="p">.</span><span class="n">SetActive</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span> <span class="c1">// LanderVisual 和 Lander 一起被禁用</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="unity-会在对象销毁时自动清理这些引用">Unity 会在对象销毁时自动清理这些引用
</h4><p>最佳实践是使对象在被销毁时取消注册：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="kd">private</span> <span class="k">void</span> <span class="n">OnDestroy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">lander</span> <span class="p">!=</span> <span class="kc">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnUpForce</span> <span class="p">-=</span> <span class="n">Lander_OnUpForce</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnLeftForce</span> <span class="p">-=</span> <span class="n">Lander_OnLeftForce</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnRightForce</span> <span class="p">-=</span> <span class="n">Lander_OnRightForce</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnBeforeForce</span> <span class="p">-=</span> <span class="n">Lander_OnBeforeForce</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">lander</span><span class="p">.</span><span class="n">OnLanded</span> <span class="p">-=</span> <span class="n">Lander_OnLanded</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="以下情况下必须进行取消注册的操作">以下情况下必须进行取消注册的操作：
</h3><ol>
<li>订阅者生命周期比发布者短</li>
<li>订阅者可能被多次创建/销毁（不取消注册会导致重复订阅）</li>
<li>跨场景的事件</li>
</ol>
<blockquote class="alert alert-tip">
    <p>养成取消注册的习惯是更安全的做法，可以避免：</p>
<ul>
<li>内存泄漏</li>
<li>重复触发</li>
<li>难以追踪的 bug</li>
</ul></blockquote>
<blockquote class="alert alert-note">
    <p>应该始终遵循：<strong>注册在哪里，就在对应的清理方法中取消注册</strong></p></blockquote>
<h4 id="取消注册的地方">取消注册的地方
</h4><p>取消注册的地方一般有 Destroy 和 Disable 两个，具体应该怎么选择？<strong>根据事件取消注册的时机选择</strong>。</p>
<p><strong>核心原则：配对原则</strong></p>
<p>事件的注册和取消注册应该在对应的生命周期方法中配对：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">注册位置</th>
          <th style="text-align: left">取消注册位置</th>
          <th style="text-align: left">使用场景</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">Awake() / Start()</td>
          <td style="text-align: left">OnDestroy()</td>
          <td style="text-align: left">对象生命周期内只需注册一次</td>
      </tr>
      <tr>
          <td style="text-align: left">OnEnable()</td>
          <td style="text-align: left">OnDisable()</td>
          <td style="text-align: left">对象会被重复启用/禁用</td>
      </tr>
  </tbody>
</table></div>
<h3 id="visual-和-logic-分开">visual 和 logic 分开
</h3><p>在此项目里，Code Monkey将visual的所有脚本也都挂在主游戏物体上，而sprite只是一张干净的图片。这种做法适用于：</p>
<ul>
<li>小型项目</li>
<li>视觉简单</li>
<li>没有皮肤系统</li>
<li>没有复杂动画</li>
<li>没有多层视觉组件</li>
<li>逻辑和视觉的耦合度低</li>
</ul>
<p>还有另一种做法，是将负责visual的脚本放在sprite的子物体上，这种做法在大型项目中常用，适用于：</p>
<ul>
<li>角色有多层视觉</li>
<li>有皮肤系统</li>
<li>有动画状态机</li>
<li>有 UI 绑定</li>
<li>有粒子、特效、灯光</li>
<li>有多人同步（视觉不参与同步）</li>
</ul>
<p>优点：</p>
<ul>
<li>完全解耦</li>
<li>视觉可替换</li>
<li>逻辑可复用</li>
<li>Prefab 更模块化</li>
<li>更适合大型项目</li>
</ul>
<h3 id="polish">Polish
</h3><p>Code Monkey一再强调polish的重要性，我也非常认同，但是我学习这门课程主要是为了看专业独立游戏开发者如何用clean code、以模块化的方式开发松耦合的、可扩展的游戏，所以polish部分就先不做了。</p>
<p>关于polish的各种技巧，我计划学习一门课程去掌握。</p>
<p>在此记录一下code monkey在课程中所用的插件，今天我要用的时候可以参考使用：</p>
<ul>
<li>Feel（Code Monkey有review视频）</li>
<li>All in 1 Sprite Shader （Code Monkey有review视频）</li>
<li>Text Animatior</li>
<li>Hot Reload</li>
<li>Code Monkey Toolkit</li>
</ul>
<h2 id="复盘和下一步">复盘和下一步
</h2><p>即使这只是一门入门课程，我还是学到了很多东西，最主要的包括：</p>
<ul>
<li>
<p>visual 和 logic 分离的原则</p>
<p>就这个体量的项目而言，sprite上不挂任何脚本，全部放在空游戏物体中</p>
</li>
<li>
<p>单一职责原则</p>
<p>每个类、每个函数都相对小，只负责一件事件</p>
</li>
<li>
<p>观察者模式</p>
<p>通过观察者模式进行了大量解耦，包括UI、音效等</p>
</li>
<li>
<p>使用C#标准的EventHandler的优点</p>
<p>除了可以正常命名外，还可以添加参数，有时非常有用</p>
</li>
<li>
<p>InputSystem的用法</p>
<p>相较于老的输入系统而言，新的输入系统连接不同输入设备时几乎不需要改代码，很方便</p>
</li>
<li>
<p>用prefab的方式来新增关卡</p>
<p>我第一次知道这种方式。总结对比在关卡设计时使用scene和prefab：</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">项目</th>
          <th style="text-align: left">Scene 做关卡</th>
          <th style="text-align: left">Prefab 做关卡</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><strong>适合的游戏类型</strong></td>
          <td style="text-align: left">大型场景、剧情关卡、独立世界</td>
          <td style="text-align: left">多关卡、重复结构、程序生成、roguelike</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>加载方式</strong></td>
          <td style="text-align: left">切换场景（LoadScene）</td>
          <td style="text-align: left">在同一场景中实例化 Prefab</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>编辑体验</strong></td>
          <td style="text-align: left">直观、所见即所得</td>
          <td style="text-align: left">模块化、可组合</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>性能</strong></td>
          <td style="text-align: left">场景切换有开销</td>
          <td style="text-align: left">Prefab 实例化更快</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>复用性</strong></td>
          <td style="text-align: left">低（每个 Scene 独立）</td>
          <td style="text-align: left">高（Prefab 可重复使用）</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>动态生成</strong></td>
          <td style="text-align: left">不方便</td>
          <td style="text-align: left">非常方便</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>多人协作</strong></td>
          <td style="text-align: left">场景容易冲突</td>
          <td style="text-align: left">Prefab 冲突更少</td>
      </tr>
      <tr>
          <td style="text-align: left"><strong>关卡数量</strong></td>
          <td style="text-align: left">少量关卡</td>
          <td style="text-align: left">大量关卡</td>
      </tr>
  </tbody>
</table></div>
</li>
</ul>
<p><strong>下一步</strong>：</p>
<p>原版课程里还有一些Bonus的游戏机制：</p>
<ul>
<li>货物运输</li>
<li>钥匙开关</li>
<li>风区</li>
<li>动态陨石</li>
<li>大炮射击</li>
</ul>
<p>我计划先放一下，等再学习练习一段时间后尝试自己实现。</p>
<p>另外，Code Monkey是我跟随学习的第一位专业游戏开发者，我会再学习2名专业游戏开发者的课程，学习他们的代码风格和对游戏整体的架构，然后尝试形成我自己的风格。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/game-dev/">Game Dev</a>
        
            <a href="/tags/unity/">Unity</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-copyright">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-clock">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Feb 09, 2026 21:33 &#43;0800
        </span>
    </section></footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/unity%E7%94%A8unity%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E4%B8%89%E6%B6%88%E6%B8%B8%E6%88%8F/">
        
        
            <div class="article-image">
                <img src="/p/unity%E7%94%A8unity%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E4%B8%89%E6%B6%88%E6%B8%B8%E6%88%8F/cover.9b94936f2650f11587a9d3d2cc58a921_hu_c18fc6099f3d27b0.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【Unity】用Unity开发一个三消游戏"
                        
                        data-hash="md5-m5STbyZQ8RWHqdPSzFipIQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【Unity】用Unity开发一个三消游戏</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E7%BB%83%E6%89%8B%E6%97%A5%E5%BF%97unity%E5%B0%8F%E6%B8%B8%E6%88%8F%E9%9B%86%E9%94%A6-2/">
        
        
            <div class="article-image">
                <img src="/p/%E7%BB%83%E6%89%8B%E6%97%A5%E5%BF%97unity%E5%B0%8F%E6%B8%B8%E6%88%8F%E9%9B%86%E9%94%A6-2/cover.e234c6f5d3ed6725521421ec36928286_hu_f1d3211ccc597964.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【练手日志】Unity小游戏集锦 2"
                        
                        data-hash="md5-4jTG9dPtZyVSFCHsNpKChg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【练手日志】Unity小游戏集锦 2</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/solidsolid%E5%8E%9F%E5%88%99%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/">
        
        
            <div class="article-image">
                <img src="/p/solidsolid%E5%8E%9F%E5%88%99%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/cover.692841708aeddf19659467c6f14cb721_hu_82e846adb3b35da9.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【SOLID】SOLID原则项目实践"
                        
                        data-hash="md5-aShBcIrt3xlllGfG8Uy3IQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【SOLID】SOLID原则项目实践</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E7%BB%83%E6%89%8B%E6%97%A5%E5%BF%97unity%E5%B0%8F%E6%B8%B8%E6%88%8F%E9%9B%86%E9%94%A6-1/">
        
        
            <div class="article-image">
                <img src="/p/%E7%BB%83%E6%89%8B%E6%97%A5%E5%BF%97unity%E5%B0%8F%E6%B8%B8%E6%88%8F%E9%9B%86%E9%94%A6-1/cover.d5dbc02814bce8e0638eacc5fc66ce99_hu_32f4ec35952ac793.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【练手日志】Unity小游戏集锦 1"
                        
                        data-hash="md5-1dvAKBS86OBjjqzF/GbOmQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【练手日志】Unity小游戏集锦 1</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84c-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E6%A4%8D%E7%89%A9%E6%98%8E%E6%98%9F%E5%A4%A7%E4%B9%B1%E6%96%97%E4%B9%8Bgameplay%E5%B1%82%E5%AE%9E%E7%8E%B0/">
        
        
            <div class="article-image">
                <img src="/p/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84c-%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E6%A4%8D%E7%89%A9%E6%98%8E%E6%98%9F%E5%A4%A7%E4%B9%B1%E6%96%97%E4%B9%8Bgameplay%E5%B1%82%E5%AE%9E%E7%8E%B0/cover.1b012a76c5604bf796bf2aca3a991558_hu_ff7b20efb25024f9.webp" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post 【从零开始的C&#43;&#43;游戏开发】植物明星大乱斗之Gameplay层实现"
                        
                        data-hash="md5-GwEqdsVgS/eWvyrKOpkVWA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">【从零开始的C&#43;&#43;游戏开发】植物明星大乱斗之Gameplay层实现</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
       
    <section class="totalcount">
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        发表了15篇文章 ·
        总计8万5千字
        <br>
    </section>


    
    <section class="running-time">
        本博客已运行
        <span id="runningdays" class="running-days"></span>
    </section>

    <section class="copyright">
        &copy;
        
        2025 -
        
        2026 Nullshow
    </section>

    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
                data-version="3.31.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>

</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><script type="text/javascript" src="/ts/custom.711fbb0ee2e4cf3223d76423fbe2fc4e019ec898fb854a9d7bea4eb3169278df.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script>
(() => {
    
    if (window.__L2D_WIDGET_INITED__) return;
    window.__L2D_WIDGET_INITED__ = true;

    const cdnPath = "https://cdn.jsdelivr.net/gh/letere-gzj/live2d-widget-v3@main";
    const config = {
        path: {
            homePath: "/",
            modelPath: "https://cdn.jsdelivr.net/gh/NullshowJL/hugo-static-resources@3aa0848/",
            cssPath: '\/waifu\/waifu.css',
            tipsJsonPath: '\/waifu\/waifu-tips.json',
            tipsJsPath: cdnPath + "/waifu-tips.js",
            live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
            live2dSdkPath: cdnPath + "/live2d-sdk.js"
        },
        tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "photo", "info", "quit"],
        drag: { enable: true, direction: ["x", "y"] },
        switchType: "order"
    };

    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(config.path.cssPath, "css"),
            loadExternalResource(config.path.live2dCorePath, "js"),
            loadExternalResource(config.path.live2dSdkPath, "js"),
            loadExternalResource(config.path.tipsJsPath, "js")
        ]).then(() => {
            initWidget({
                waifuPath: config.path.tipsJsonPath,
                cdnPath: config.path.modelPath,
                tools: config.tools,
                dragEnable: config.drag.enable,
                dragDirection: config.drag.direction,
                switchType: config.switchType
            });
        });
    }

    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            } else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }
})();
</script>

<style>
     
    #waifu #waifu-tool,
    #waifu .waifu-tool,
    #waifu .waifu-toolbar,
    #waifu .waifu-tools {
        transform: translateY(-50px);
        z-index: 1001;  
    }
</style>


<style>
    @font-face {
        font-family: 'WenKai';
        src: url(https://nullshowjl.github.io/font/WenKai.ttf) format('truetype');
    }

    @font-face {
        font-family: 'Mate';
        src: url(https://nullshowjl.github.io/font/Mate.ttf) format('truetype');
    }

    @font-face {
        font-family: 'SourceCodePro';
        src: url(https://nullshowjl.github.io/font/SourceCodePro.ttf) format('truetype');
    }

    :root {
        --base-font-family: 'Mate', 'WenKai', sans-serif;
        --code-font-family: 'SourceCodePro';
    }

    body {
        font-family: 'Mate', 'WenKai', sans-serif;
        font-display: swap;
    }

    code,
    pre {
        font-family: var(--code-font-family), monospace;
        white-space: pre;
         
        tab-size: 4;
         
    }
</style>


<style>
  #TableOfContents > ul ul,
  #TableOfContents > ul ol,
  #TableOfContents > ol ul,
  #TableOfContents > ol ol { display: none; }
  #TableOfContents .open { display: block; }
</style>

<script>
    function initTocHide() {
        const toc = document.querySelector(".widget--toc");
        if (!toc) return;

        window.addEventListener("scroll", () => {
            document.querySelectorAll(".open").forEach((ul) => ul.classList.remove("open"));

            const currentLi = document.querySelector(".active-class");
            if (!currentLi) return;

            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open");
            }

            let ul = currentLi.parentElement;
            while (ul && (ul.localName === "ul" || ul.localName === "ol")) {
                ul.classList.add("open");
                ul = ul.parentElement?.parentElement;
            }
        });
    }

    initTocHide();
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        right: left: 60%;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url('https://nullshowjl.github.io/icons/backTop.svg');
        background-size: cover;
    }
</style>

<script>
    function initScrollTop() {
        const rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) return;

        const btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop;
        rightSideBar.appendChild(btn);

        window.onscroll = () => {
            const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
            btn.style.display = scrollTop > 20 ? "block" : "none";
        };
    }

    function backToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
        position: relative;
    }

    .code-show {
        max-height: none !important;
        overflow: visible !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    const codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) return;

    codeBlocks.forEach((codeBlock) => {
      if (codeBlock.querySelector(".code-more-box")) return;
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) return;

      const codeMoreBox = document.createElement("div");
      codeMoreBox.classList.add("code-more-box");

      const codeMoreBtn = document.createElement("span");
      codeMoreBtn.classList.add("code-more-btn");

      const img = document.createElement("img");
      img.classList.add("code-more-img");
      img.src = 'https:\/\/nullshowjl.github.io\/icons\/codeMore.png';

      codeMoreBtn.appendChild(img);
      codeMoreBtn.addEventListener("click", () => {
        codeBlock.classList.add("code-show");
        codeMoreBox.remove();
        window.dispatchEvent(new Event("resize"));
      });

      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox);
    });
  }

  initCodeMoreBox();
</script>


<script defer src="https://cn.vercount.one/js"></script>

<script>
    function showHideView() {
        const viewCounts = document.querySelectorAll("#viewCount");
        if (!viewCounts.length) return;

        const article = document.querySelector(".article-page");
        if (!article) {
            viewCounts.forEach((ele) => {
                ele.style.display = "none";
            });
        }
    }

    showHideView();
</script>





<div id="particles-js"></div>

<script src="https://nullshowjl.github.io/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', 'https:\/\/nullshowjl.github.io\/background\/particlesjs-config.json', function () {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
    #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
</style>


<div id="jsi-flying-fish-container" class="flying-fish-container"></div>

<script src="/js/renderer.js"></script>
<script>
    window.onload = () => {
        if (typeof RENDERER !== 'undefined') {
            RENDERER.init();
        }
    };
</script>


<script>
    (() => {
        const start = new Date('2025-09-14'); 
        const now = new Date();

        let years = now.getFullYear() - start.getFullYear();
        let months = now.getMonth() - start.getMonth();
        let days = now.getDate() - start.getDate();

        if (days < 0) {
            months -= 1;
            const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
            days += prevMonth.getDate();
        }

        if (months < 0) {
            years -= 1;
            months += 12;
        }

        const result = `${years}年${months}月${days}天`;
        const runningEl = document.getElementById('runningdays');
        if (runningEl) {
            runningEl.textContent = result;
        }
    })();
</script>


        
<script>
(() => {
    
    if (window.__L2D_WIDGET_INITED__) return;
    window.__L2D_WIDGET_INITED__ = true;

    const cdnPath = "https://cdn.jsdelivr.net/gh/letere-gzj/live2d-widget-v3@main";
    const config = {
        path: {
            homePath: "/",
            modelPath: "https://cdn.jsdelivr.net/gh/NullshowJL/hugo-static-resources@3aa0848/",
            cssPath: '\/waifu\/waifu.css',
            tipsJsonPath: '\/waifu\/waifu-tips.json',
            tipsJsPath: cdnPath + "/waifu-tips.js",
            live2dCorePath: cdnPath + "/Core/live2dcubismcore.js",
            live2dSdkPath: cdnPath + "/live2d-sdk.js"
        },
        tools: ["hitokoto", "asteroids", "express", "switch-model", "switch-texture", "photo", "info", "quit"],
        drag: { enable: true, direction: ["x", "y"] },
        switchType: "order"
    };

    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(config.path.cssPath, "css"),
            loadExternalResource(config.path.live2dCorePath, "js"),
            loadExternalResource(config.path.live2dSdkPath, "js"),
            loadExternalResource(config.path.tipsJsPath, "js")
        ]).then(() => {
            initWidget({
                waifuPath: config.path.tipsJsonPath,
                cdnPath: config.path.modelPath,
                tools: config.tools,
                dragEnable: config.drag.enable,
                dragDirection: config.drag.direction,
                switchType: config.switchType
            });
        });
    }

    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            } else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }
})();
</script>

<style>
     
    #waifu #waifu-tool,
    #waifu .waifu-tool,
    #waifu .waifu-toolbar,
    #waifu .waifu-tools {
        transform: translateY(-50px);
        z-index: 1001;  
    }
</style>


<style>
    @font-face {
        font-family: 'WenKai';
        src: url(https://nullshowjl.github.io/font/WenKai.ttf) format('truetype');
    }

    @font-face {
        font-family: 'Mate';
        src: url(https://nullshowjl.github.io/font/Mate.ttf) format('truetype');
    }

    @font-face {
        font-family: 'SourceCodePro';
        src: url(https://nullshowjl.github.io/font/SourceCodePro.ttf) format('truetype');
    }

    :root {
        --base-font-family: 'Mate', 'WenKai', sans-serif;
        --code-font-family: 'SourceCodePro';
    }

    body {
        font-family: 'Mate', 'WenKai', sans-serif;
        font-display: swap;
    }

    code,
    pre {
        font-family: var(--code-font-family), monospace;
        white-space: pre;
         
        tab-size: 4;
         
    }
</style>


<style>
  #TableOfContents > ul ul,
  #TableOfContents > ul ol,
  #TableOfContents > ol ul,
  #TableOfContents > ol ol { display: none; }
  #TableOfContents .open { display: block; }
</style>

<script>
    function initTocHide() {
        const toc = document.querySelector(".widget--toc");
        if (!toc) return;

        window.addEventListener("scroll", () => {
            document.querySelectorAll(".open").forEach((ul) => ul.classList.remove("open"));

            const currentLi = document.querySelector(".active-class");
            if (!currentLi) return;

            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open");
            }

            let ul = currentLi.parentElement;
            while (ul && (ul.localName === "ul" || ul.localName === "ol")) {
                ul.classList.add("open");
                ul = ul.parentElement?.parentElement;
            }
        });
    }

    initTocHide();
</script>


<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        right: left: 60%;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url('https://nullshowjl.github.io/icons/backTop.svg');
        background-size: cover;
    }
</style>

<script>
    function initScrollTop() {
        const rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) return;

        const btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop;
        rightSideBar.appendChild(btn);

        window.onscroll = () => {
            const scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
            btn.style.display = scrollTop > 20 ? "block" : "none";
        };
    }

    function backToTop() {
        window.scrollTo({ top: 0, behavior: "smooth" });
    }

    initScrollTop();
</script>


<style>
    .highlight {
        max-height: 400px;
        overflow: hidden;
        position: relative;
    }

    .code-show {
        max-height: none !important;
        overflow: visible !important;
    }

    .code-more-box {
        width: 100%;
        padding-top: 78px;
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0), #fff);
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 1;
    }

    .code-more-btn {
        display: block;
        margin: auto;
        width: 44px;
        height: 22px;
        background: #f0f0f5;
        border-top-left-radius: 8px;
        border-top-right-radius: 8px;
        padding-top: 6px;
        cursor: pointer;
    }

    .code-more-img {
        cursor: pointer;
        display: block;
        margin: auto;
        width: 22px;
        height: 16px;
    }
</style>

<script>
  function initCodeMoreBox() {
    const codeBlocks = document.querySelectorAll(".highlight");
    if (!codeBlocks) return;

    codeBlocks.forEach((codeBlock) => {
      if (codeBlock.querySelector(".code-more-box")) return;
      if (codeBlock.scrollHeight <= codeBlock.clientHeight) return;

      const codeMoreBox = document.createElement("div");
      codeMoreBox.classList.add("code-more-box");

      const codeMoreBtn = document.createElement("span");
      codeMoreBtn.classList.add("code-more-btn");

      const img = document.createElement("img");
      img.classList.add("code-more-img");
      img.src = 'https:\/\/nullshowjl.github.io\/icons\/codeMore.png';

      codeMoreBtn.appendChild(img);
      codeMoreBtn.addEventListener("click", () => {
        codeBlock.classList.add("code-show");
        codeMoreBox.remove();
        window.dispatchEvent(new Event("resize"));
      });

      codeMoreBox.appendChild(codeMoreBtn);
      codeBlock.appendChild(codeMoreBox);
    });
  }

  initCodeMoreBox();
</script>


<script defer src="https://cn.vercount.one/js"></script>

<script>
    function showHideView() {
        const viewCounts = document.querySelectorAll("#viewCount");
        if (!viewCounts.length) return;

        const article = document.querySelector(".article-page");
        if (!article) {
            viewCounts.forEach((ele) => {
                ele.style.display = "none";
            });
        }
    }

    showHideView();
</script>





<div id="particles-js"></div>

<script src="https://nullshowjl.github.io/background/particles.min.js"></script>
<script>
  particlesJS.load('particles-js', 'https:\/\/nullshowjl.github.io\/background\/particlesjs-config.json', function () {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
    #particles-js {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
    }
</style>


<div id="jsi-flying-fish-container" class="flying-fish-container"></div>

<script src="/js/renderer.js"></script>
<script>
    window.onload = () => {
        if (typeof RENDERER !== 'undefined') {
            RENDERER.init();
        }
    };
</script>


<script>
    (() => {
        const start = new Date('2025-09-14'); 
        const now = new Date();

        let years = now.getFullYear() - start.getFullYear();
        let months = now.getMonth() - start.getMonth();
        let days = now.getDate() - start.getDate();

        if (days < 0) {
            months -= 1;
            const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
            days += prevMonth.getDate();
        }

        if (months < 0) {
            years -= 1;
            months += 12;
        }

        const result = `${years}年${months}月${days}天`;
        const runningEl = document.getElementById('runningdays');
        if (runningEl) {
            runningEl.textContent = result;
        }
    })();
</script>


    </body>
</html>


